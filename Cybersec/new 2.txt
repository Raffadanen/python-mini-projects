import os
import sys
import time
import json
import threading
import queue
import textwrap
from typing import List
from collections import defaultdict

# ASCII PORTRAIT KARAKTER 

PORTRAIT = {
    "ALEX": [
        "                                          ",
   "         ▓████████████░             ",
   "       ░████████████████▓           ",
   "      ▓███████████████████▓         ",
   "      █████████████████████░        ",
   "     ███████████████████████        ",
   "     ▒█████▓▒▒▒▒▒▒▒▒▒▓██████        ",
   "     ▒█████▒▓▓▓▒▒▒▓▓▓▒█████         ",
   "      ▓██▓▒▒▒▒▒▒▒▒▒▒▒▒▒███          ",
   "       ▒███▒▒▒████▓▒▒▓███░          ",
   "          ▒███████████▒             ",
   "           █████ █████              ",
   "          ██████ ██████             ",
   "         ██████▒ ▒▒ ████            ",
   "         ▓██████ ██▓████            ",
   "        ░▒▓███████████▓▒▒           ",
   "        ░▒▒███████████▓▒▒           ",
   "        ░▒▒           ▒▓▒           ",
   "         ░             ▒            ",
   "                                    ",
   "                                    ",
   "                                    ",
   "          ░█████ ▓████▒             ",
   "                                    ",
    ],

       "ADRIAN": [
        "                                          ",
   "                                              ", 
   "              ░   ░                 ",
   "          ▒███████████▓             ",
   "        ░███████████████░           ",
   "        ████████▓████████           ",
   "        ███▓▒▓▓▒▒▒▓▓▒▓███           ",
   "        ░██▒░░░▒▒▒░░░▒██░           ",
   "         ░█▒ ▒█▒▒▒█▓ ▒█░            ",
   "         ░▒▒▒▒▒▒▒▒▒▒▒▒▒░            ",
   "           ░▒▒▒███▒▒▒░              ",
   "             ░█████░                ",
   "           █████ █████              ",
   "          ██████ ▓█████▒            ",
   "         ██▓▓██▓▒▓▓░████            ",
   "         ▓▓█▒▒▒▒▒▓█▒▒▒▒▒            ",
   "          ░███████████░             ",
   "           ███████████              ",
   "                                    ",
   "                               ",
   "                                    ",
   "          ░█████ ▒████▓             ",
   "                                    ",
    ],

       "AMELIA": [
        "                                          ",
   "                                    ",                                    
   "                                    ",
   "           ▒██████████░             ",
   "         ▒██████████████            ",
   "         ████▒▒██████████           ",
   "        ░███▒▒▒▒▓████████           ",
   "         ██▒▒▒▒▒▒██▓█████           ",
   "         ██░█▒▒░░█████▓███          ",
   "         ▓█▒▒▒▒▒▒▒▒██████▓░         ",
   "       ░▒▓░█▒▒▒▒▒▒▒███████          ",
   "       ░▒▓ ███░▓▒ ▒███████          ",
   "        ▒ █████▒██████████░         ",
   "         ▒▒███████████████          ",
   "          ██████████▒▒███           ",
   "            ░███████░░▒░▒           ",
   "            ░▒▒▒▒▒▒░░░              ",
   "                    ▒░              ",
   "                                    ",
   "                                    ",
   "                                    ",
   "           ░███░ ███                ",
   "                                      ",
    ],

       "BALDI": [                                                         
        "       ██████████              ",
        "     ██████████████            ",
        "    ███████████████            ",
        "    ████▓▒▒▒▒▒▒▒▒▒░            ",
        "    ▒███▓█░░█▓█▒█▒░▒           ",
        "     ▒█▓▒█░ █▒█▒█▒ ░           ",
        "     ░░▒▒▒▒▒▒▒▒▒▒▒▒            ",
        "        ░▒▒▒▒▒▒▒▒░             ",
        "          ▒▓░       ░▒▒░       ",
        "      ███  ░  █▓░ ░░▒▒▒        ",
        "    ░███████████▓▒▒░           ",
        "    ▒▒▒███████▒                ",
        "   ▒▒  ███████▒                ",
        "   ▒▒  ███████▒                ",
        "  ░▒▒                          ",
        "                               ",
        "                               ",
        "                               ",
        "    ▓███       ████            ",
        "      ██       ██              ",
        "                                ",
   "                                    ",
    ],

       "BALQIS": [
        "                                          ",
   "                                               ",
   "     ██████▓            ░██████░     ",
   "   ▒█████████ ░███▓██▒ ██████████    ",
   "    ████████████████████████████     ",
   "   ███████▓██████████████▓███████    ",
   "   ▓▒████░▓██████▒▒▒█████▒░██████    ",
   "    ██    ░█▓▒░░░▒▒▒░░░▒█▒    ░█▓    ",
   "           ▒▓░ ██▒▒▒█  ▒█░           ",
   "           ░▒▒▒▒▒▒▒▒▒▒▒▒░            ",
   "             ░▒▒▒▓▓▒▒▒░░             ",
   "                ░▒▒▒                 ",
   "            ███▓    ░███             ",
   "         █████████░██████▒           ",
   "        ░▒██▓█████████████           ",
   "        ░▒▒░░██████████▓▒▒           ",
   "          ░▒▓██████████▓▒▒           ",
   "            ▒██████████▓▒▒           ",
   "                       ▒░░▓          ",
   "                       ▒████         ",
   "                       ▒████         ",
   "                       ▒████         ",
   "             ░░      ░░              ",
   "            █████  █████▒            ",
   "                                              ",
   "                                    ",
    ],

       "BU MADRINAH": [
        "                                          ",
   "                                      ",              
    "                                   ",
    "          ▒█████████▒              ",
    "          ████████████▓             ",
    "        ▒███▒▒▒▒▒▒▒███░            ",
    "        ██▓██▒▒▒▒▓██▓██            ",
    "        ███░░██▓██░░███            ",
    "        ███░ ▓▓▓█▒░▒███            ",
    "        ▓█▓▒▒▒▓▓▓▒▒▒▓█▒            ",
    "         ██▓▓▒▒▒▒▓▓██▒             ",
    "          ███████████              ",
    "          ███████████              ",
    "          ▓██████▓██▓              ",
    "          ▓███▓█▓███▓              ",
    "          ▓█▓█████▓█▓ ▓            ",
    "          ░▓▓██████▒░ ▓            ",
    "          ░▒███████▒▒░▓            ",
    "            ██░ ███                ",
    "            ██░ ███                ",
    "            ██░ ███                ",
    "           ███▒ ████               ",
    "           ░░░   ░░░               ",
    "                                    ",
    ],

       "DAFIR": [
        "                                          ",
   "                                               ",
    "           ░░█▒░▒█░░               ",
    "        ░█████████████░            ",
    "       ▒███████████████▒           ",
    "       █████████████████           ",
    "       ███▓▒▒▒░░░▒▒▒▓███           ",
    "       ░██████▓▒▓██████░           ",
    "        ░█▓ ░██▓█▓▓ ▒█░            ",
    "        ░▓█████▒█████▓░            ",
    "          ░▒▒▒███▒▒▒░              ",
    "            ░█████░                ",
    "          █████ █████              ",
    "         ██████ ▒█████▒            ",
    "        ██████▒ ░█ ████            ",
    "        ▒██████░██████▓░           ",
    "        ▒▒████████████▒▒           ",
    "        ▒▒███████████▓▒▓           ",
    "        ▒▓           ▒▓▓           ",
    "        ░             ▒            ",
    "                                   ",
    "                                   ",
    "                                   ",
    "         ░█████ ▒████▓             ",
    "                                     ",
   "                                    ",
    ],

       "DAKA": [
        "                                          ",
   "                                    ",           
    "                                   ",
    "           ░██▓███                 ",
    "        █████████████░             ",
    "      █████████████████            ",
    "     ░██████▒▓▒▒▒▓▓▒▓██            ",
    "     ░█████▒▒██▓▒▒▒▓█░             ",
    "      ███████░▒██▒▓█▓              ",
    "      ▓█▒▓█▒█░▒██▒▓██              ",
    "       ░▓▓▒▒▒▒▒▒▒▒▒▒▒░             ",
    "         ░░░▒▒▒▒▒▒▒▒░              ",
    "             ▓▓▒                   ",
    "         █████████                 ",
    "       ░███████████                ",
    "      ░▒▒▒░████████▒               ",
    "      ░▒░  ███████▒▒               ",
    "        ░▒░███████░                ",
    "         ░▒                        ",
    "                                   ",
    "                                   ",
    "                                   ",
    "          ░░░  ░░░                 ",
    "          ███ ░████                ",
    "                                    ",
   "                                    ",
    ],

       "DIANIRA": [
        "                                          ",
   "                                      ",         
   "                                    ",
   "            █████████               ",
   "     ███████████████████████        ",
   "    ░███████████▓████████████       ",
   "    ████████▒▒▒▒▒▒▒▒▒████████       ",
   "   █████████████▒▓████████████      ",
   "   ██████▒█▓ ░████▒█ ▒█▒██████      ",
   "  ▒██████▓▓█████▒█████▓▒██████▓     ",
   "  ▒███████ ░▒▒▒█▓█▒▒▒░ ▒██████▓     ",
   "   ▒█████▒     ░▒▒░    ░██████      ",
   "    ████▒  ███     ███    ███       ",
   "          ██▒░██ ░██░██▒            ",
   "         ██████▓ ░▒█████            ",
   "         ▒▒▓▓███████▓▓▒▒            ",
   "         ▒▒▒▒███████▓▒▒▒            ",
   "           ███████████░             ",
   "                                    ",
   "                                    ",
   "                                    ",
   "                                    ",
   "            ░       ░               ",
   "          ██████ ░█████             ",
   "                                      ",
   "                                    ",
    ],

       "FIRDAUS": [
        "                                          ",
   "                                        ",       
   "                ░                   ",
   "            ████████░               ",
   "         ▒█████████████░            ",
   "         ███████████████            ",
   "        ░█████████▒█████            ",
   "         ██▒▒▒▒▒▒▒▒▒▒▓█▓            ",
   "         ░█▒▓▓▓▒▒▒▓▓▓▒█░            ",
   "         ░▒▒▒▒▒▒▒▒▒▒▒▒▒░            ",
   "           ░▒▒████▓▒▒░              ",
   "             ░█████░                ",
   "           █████ █████              ",
   "          ██████ ▓█████░            ",
   "         ██████▒ ▒▓ ████            ",
   "         ▓██████ ███████░           ",
   "         ▒▓████████████▒▒           ",
   "        ░▒▒███████████▓▒▒           ",
   "        ░▒▓           ▒▓▒           ",
   "         ░             ▒            ",
   "                                    ",
   "                                    ",
   "                                    ",
   "          ░█████ ▓████▒             ",
   "                                     ",
    ],

       "KHENZA": [
        "                                          ",
   "                                      ",         
   "             ███▓▓██▓░              ",
   "          ██████████████            ",
   "         █████████████████          ",
   "        ██████████████████          ",
   "       █████▒▒▒▒▒▒▒▒▒▒█████         ",
   "       █████████▒▒█████████         ",
   "       ██▒█▓░ ████▒█  █████         ",
   "       ███▒█████▒▓█████▒███         ",
   "       █████▒▒▒▓██▓▒▒▒█████         ",
   "       ████████████████████           ",  
   "        ████████▓░████████          ",
   "          ██████░▒██████░           ",
   "         ▓█████████  ███▒           ",
   "         ░▒███▒████▓░██▓▒           ",
   "         ░▒▒▒▒▒▒██▒▒▒▒▒▒▒           ",
   "           ████████████             ",
   "                                    ",
   "                                    ",
   "                                    ",
   "                                    ",
   "                                    ",
   "           █████  █████▒            ",
   "                                      ",
   "                                    ",
    ],

       "KILAU": [
        "                                          ",
   "                                      ",        
   "             ░     ░                ",
   "          ▒█████████████            ",
   "         ████████████████           ",
   "        ░█████████████████          ",
   "        ████████▓█████████░         ",
   "        ████████▓▓████████░         ",
   "        █▓▓█░ ████▒█  ██▓█░         ",
   "        ██▒██████▓█████▒██░         ",
   "        ████▒▒▒▓▓▓█▒▒▒████░         ",
   "        ████████▒▒▒███████░         ",
   "        ██████▓    ░██████░         ",
   "        █████░██▒ ██▓█████░         ",
   "        ███████▓▒░▒▓██████░         ",
   "        █▒▒▓▓████████▓█▒▒█░         ",
   "         ░▒▒▒▓██████▓▒▒▒▒           ",
   "           ▓███████████             ",
   "                                    ",
   "                                    ",
   "                                    ",
   "                                    ",
   "            ░░                      ",
   "           █████░ █████▓            ",
   "                                           ",
   "                                    ",
    ],

       "LEYA": [
        "                                          ",
   "                                    ",
   "              ░░  ░                 ",
   "            █████████               ",
   "          █████████████             ",
   "          ██████▒▓██████            ",
   "         ▒██▒▓▓▒▒▒▓▓▒███            ",
   "         ▒██░ ██▒▒█▓░▓██            ",
   "         ▒██▒▒▒▒▓▒▒▒▒▓██            ",
   "         ▒███▒▒▒▒▒▒▒▓███            ",
   "         ▒████▓▒▓▒▒█████            ",
   "         ▒██████ ▓▓█████            ",
   "          █████▓▓▓▓████             ",
   "          ▒▒█████████▒▒             ",
   "          ░▒▒▓▓▓▓▓▓▓▒▒░             ",
   "            ▓███████▓░              ",
   "              ▓▓▓▓▓▒                ",
   "                                    ",
   "                                    ",
   "                                    ",
   "            ████ ░████              ",
   "                                            ",
   "                                    ",
    ],

       "MAK NYAK": [
        "                                          ",
    "                                   ",
    "           ████████░               ",
    "         ████████████              ",
    "        ░██▒░▒██▓█████             ",
    "        ░█ █▒▒ ▓█▓████             ",
    "        ░▒░▒▒▒░░▒▒████             ",
    "        ░▓▒▓██▓▒▒▒███▒             ",
    "          ▓█▓▓▓▓████░              ",
    "          ▒█████████               ",
    "         ░████████░▓               ",
    "        ░▓▓▓▓▓▓▒▓██░               ",
    "        ░▒▒▒▓▓▒▒▒▒░                ",
    "           ███████░                ",
    "          ▒████████                ",
    "           ███████░                ",
    "           ███▓███░                ",
    "           ███ ███░                ",
    "           ███ ███░                ",
    "          ████ ███▒                ",
    "               ░▒░                 ",
    "                                     ",
   "                                    ",
    ],

  

       "MICHAEL": [
        "                                          ",
   "                                      ",         
   "             ░██▓▒▓██▒              ",
   "         ▓██████████████░           ",
   "        ██████████████████          ",
   "       ████████████████████         ",
   "      ▓███████▒█▒▒▓▓▓███████        ",
   "     ██████▓▒░░░▒▒▒░░░▒█████░       ",
   "      ████▓█░ ██▒▒░█  ██████        ",
   "      ████▒▒▒▒▒▒▒▒▒▒▒▒▒▒████▒       ",
   "       █████▒▒▒▒▒▒▒▒▒▒█████░        ",
   "         ▓█████▓▒▒▒█████▓           ",
   "            ██▓    ░██              ",
   "          ███░██▒ ██▓███░           ",
   "         ██████▓▒░▒▓█████           ",
   "         ░▒▓▓▓███████▓█▒▒           ",
   "         ░▒▒▒▓██████▓▒▒▒▒           ",
   "           ▓███████████             ",
   "                                    ",
   "                                    ",
   "                                    ",
   "                                    ",
   "            ░░       ░              ",
   "           █████  █████▓            ",
   "                                         ",
    ],

       "NITA": [
        "                                          ",
   "                                      ",          
   "                                    ",
   "                                    ",
   "                     ████▓          ",
   "             ▓█████████████         ",
   "           ████████████████░        ",
   "          ██▓▒▒▒███████████░        ",
   "          █▒▒▒▒▒▒▒▒████████░        ",
   "           ▒▒▒▒▒▒██▓███████░        ",
   "        ▓▓▒░█▒▒░░██▒█▓▒████░        ",
   "        ███▒▒▒▒▒▒▒▒▒█▓█████         ",
   "       ░▒██░░▒▒▒▒▒░   █████         ",
   "       ░▒░   ▒ ▓▒  ░  ██████        ",
   "        ▒ ░████▒██████▒░███░        ",
   "         ▒▒███████████▒░            ",
   "             ███████  ▒░            ",
   "            ░███████▒░              ",
   "            ░▒▒▒▒▒▒▒▒░              ",
   "                                    ",
   "                                    ",
   "                                    ",
   "                                    ",
   "           ░███▒ ███                ",
   "                                    ",
    ],

       "PAK BUDI": [
        "                                          ",
   "                                         ",      
    "                                   ",
    "         ▒███████████              ",
    "       ████████████████            ",
    "      ██████████████████           ",
    "      ███████▓████▓█████░          ",
    "      ██████████▓▒██████░          ",
    "      ▓███▓░░██▓██░░████           ",
    "       █▒▒▓░ ▓▓▒█▒░░█▒▒            ",
    "         ░▒▒▒▒░░▒▒▒▒░              ",
    "           ░░▒▒▒▒░░                ",
    "              ▒▓                   ",
    "          ▓███▒█▒███▓              ",
    "          ████▒█▓████              ",
    "          ████▒█▓████              ",
    "          ████▒█▓████▓▓            ",
    "          ░████████▓░░▒            ",
    "          ░▒███████▒▒▒▒            ",
    "            ██░ ███                ",
    "            ██░ ███                ",
    "            ██░ ███                ",
    "           ███▒ ████               ",
    "           ░░░   ░░░               ",
    "                                   ",
    ],

       "PAK FIRMAN": [
        "                                          ",
   "                                    ",           
    "                                   ",
    "           ████████░               ",
    "         █████████████             ",
    "        ██████████████▓            ",
    "        ██▒▒▒▒▒▒▒▒▒▒▓██            ",
    "        ██▒██▒▒▒▒▒██▒██            ",
    "        ███░░██▓██░░██░            ",
    "        ▓▓█░ ▓▓▓█▒░▒█▓▒            ",
    "         ░▒▒▒▒░░▒▒▒▒▒              ",
    "           ░▒▒▒▒▒▒░                ",
    "              ▒▓                   ",
    "          ▓███▒█▒███▓              ",
    "          ████▓█▓████              ",
    "          ████▓█▓████              ",
    "          ████▒█▓█████▓            ",
    "          ░████████▓░░▒            ",
    "          ░▒███████▒▒▒▒            ",
    "            ██░ ███                ",
    "            ██░ ███                ",
    "            ██░ ███                ",
    "           ███▒ ████               ",
    "           ░░░   ░░░               ",
    "                                    ",
    ],

       "PAK UDIN": [
        "                                          ",
   "                                        ",       
    "                                   ",
    "                                   ",
    "             ▓▓▓▓▓░                ",
    "          ▓██████████              ",
    "          ██▒░▓████▒▒▓             ",
    "          ██▒███░░▓██▒             ",
    "         ░█▓▒ ▓█▒▒░▓█              ",
    "         ▒▓▒▒▒▒▒▒▓▓▒▒              ",
    "           ▒▒▒▒▓██▓▒▒              ",
    "             ▓▓▓▓▒░                ",
    "          █████▓████               ",
    "       ▒░▓████████▓██░             ",
    "      ░▒██▒██████░▓██▓░            ",
    "      ░▒▒░ ████████░▒▒▒            ",
    "        ░▒▒████████▓▒░             ",
    "         ▒▒████▓▓██▓▒              ",
    "           ████████                ",
    "           ████ ███░               ",
    "           ███░ ███                ",
    "           ███  ███                ",
    "           ███  ████               ",
    "           ▒▒▒                     ",
    "                                     ",
    ],

       "PRATAMA": [
        "                                          ",
   "                                               ",
   "                                    ",
   "                                    ",
   "                                    ",
   "           ░▓▒████░█░               ",
   "         ▒████████████              ",
   "         ██████████████             ",
   "          ▒▒▒▒▒▒▒▒▒████             ",
   "          ░▒▒▒▒░▒▒▒▓██░             ",
   "           ▓▒▒▒ ██▒▒▓▒              ",
   "          ▒▒▒▒▒▒▒▒▒▒░               ",
   "           ░▒▒▒▒▒▒░                 ",
   "             ▒ ▓▓  ░                ",
   "           ████▒██████              ",
   "           ███████████░             ",
   "           ░▒███████▒░              ",
   "           ░▓███████▒░              ",
   "           ░▒▒▒▒▒▒▒▒▒░              ",
   "           ░        ░░              ",
   "                                    ",
   "                                    ",
   "                                    ",
   "          ████▒  ███                ",
   "                                     ",
   "                                    ",
    ],

       "RUSYDAN": [
        "                                          ",
   "                                      ",         
   "                                    ",
   "                                    ",
   "             ░ ░  █ ▒░              ",
   "        ░░  █▒████▓█░█░             ",
   "          ▓████████████▒▒           ",
   "        █████████████████▓          ",
   "       ░▓█████▒████████▓▓           ",
   "        ████▓▓▓▒▒▒▓▓▒██▓█           ",
   "        █▓▒▓░░█▒▒▓█ ░██ ░           ",
   "         ░▒█▒▒▒▒▓▒▒▒▒█░░            ",
   "          ▒░░▒▒▒▒▒▒░ █              ",
   "             ▒ ▒▓░ ░                ",
   "          █████▓ █████░             ",
   "         ░████████████▓░            ",
   "        ░▒░ ████████  ▒░            ",
   "          ░▒████████▓░              ",
   "            ████████░               ",
   "                                    ",
   "                                    ",
   "                                    ",
   "                                    ",
   "           ████░ ████               ",
   "                                      ",
    ],

       "SPARTAN": [
        "                                          ",
   "                                      ",         
   "                                    ",
   "             ████▒ ██               ",
   "         ██████████████▓            ",
   "       █████████████████▒           ",
   "      ▒██████████████████           ",
   "       ███████▓█▒▓█▒▒████           ",
   "      ████████▒▒██▒▓█▓▓█▒▓          ",
   "     ████▒██▓█░▒██▒▓██▒█▒           ",
   "      ██████▒▒▒▒▒▒▒▒▒▒██            ",
   "       █████▒▒▒▒▒▒▒▒▒▓█░            ",
   "        ██████▓▓▓█████              ",
   "          ███  ░░▒█                 ",
   "        ░██████▒████                ",
   "       ░▒▒▒░████████▒               ",
   "       ░▒░  ███████▒▒               ",
   "         ░▒░███████░                ",
   "          ░▒                        ",
   "                                    ",
   "                                    ",
   "                                    ",
   "           ░░░  ░░░                 ",
   "           ███ ░████                ",
   "                                       ",
   "                                    ",
    ],

       "TRISTAN": [
        "                                          ",
   "                                      ",         
   "                                    ",
   "        ▒███████████▒               ",
   "      █████████████████             ",
   "     ███████████████████▒           ",
   "    ░███▓████████████████           ",
   "     ████████████████████           ",
   "      ░▓█ ░▒██ ░▒▒▒█████░           ",
   "        ░▒ ▒▒▓▓ ░▒▒▒█▒▒▓█            ",
   "       ░▒▒▒▒▒▒▒▒▒▒▒▒▓▓              ",
   "         ░▒▒▒▒▒▒▒░░░                ",
   "              ▓▓▓                   ",
   "      ░▒▒   ██████████              ",
   "       ░▒░ ██████████▒▒░            ",
   "         ░▒▒ ▓██████  ▒░            ",
   "             ▓██████░░▒             ",
   "             ░█████░░▒░             ",
   "                                    ",
   "                                    ",
   "                                    ",
   "       ░██▒             ██          ",
   "        ▓███▓         ░███          ",
   "                       ░░           ",
   "                                     ",
    ],

       "VARA": [
        "                                          ",
   "                                      ",         
   "                                    ",
   "             ░███▓██▒               ",
   "           ░░░░░░▒▓███▓             ",
   "          █████████▒████            ",
   "          █▓██▓█▓████▒██            ",
   "         ░█▒▒▒▒▒░██▓█████           ",
   "        ▓█▓░█▒▒░░████▓▒██           ",
   "        ███▒▒▒▒▒▒▒▒▒█████           ",
   "       ░▒███▒▒▒▒▒▒▒██████           ",
   "       ░▒░   █░▓▓ ▒█ ░ ░            ",
   "        ▒ ░████▒██████▒             ",
   "         ▒▒███████████▒░            ",
   "             ███████  ▒░            ",
   "            ░███████▒░              ",
   "            ░▒▒▒▒▒▒▒▒░              ",
   "                                    ",
   "                                    ",
   "                                    ",
   "                                    ",
   "          ████▒  ███                ",
   "                                       ",
   "                                    ",
    ],

           "VARA": [
                                           
   "                                    ",
   "            ░██▓███                 ",
   "         █████████████░             ",
   "       █████████████████            ",
   "      ░██████▒▓▒▒▒▓▓▒▓██            ",
   "      ░█████▒▒██▓▒▒▒▓█░             ",
   "       ███████░▒██▒▓█▓              ",
   "       ▓█▒▓█▒█░▒██▒▓██              ",
   "        ░▓▓▒▒▒▒▒▒▒▒▒▒▒░             ",
   "          ░░░▒▒▒▒▒▒▒▒░              ",
   "              ▓▓▒                   ",
   "          █████████                 ",
   "        ░███████████                ",
   "       ░▒▒▒░████████▒               ",
   "       ░▒░  ███████▒▒               ",
   "         ░▒░███████░                ",
   "          ░▒                        ",
   "                                    ",
   "                                    ",
   "                                    ",
   "           ░░░  ░░░                 ",
   "           ███ ░████                ",
   "                                      ",
    ],

    
}

def show_portrait(name: str):
    """Portrait buat split box (kiri)"""
    if name.upper() not in PORTRAIT:
        return [""] * 9  # kosong kalau nggak ada portrait
    
    lines = PORTRAIT[name.upper()]
    portrait_w = 20
    portrait_lines = []
    for line in lines:
        portrait_lines.append(line.center(portrait_w))
    
    # Padding kalau portrait pendek
    while len(portrait_lines) < 9:
        portrait_lines.append("".center(portrait_w))
    
    return portrait_lines

# -----------------------
# FIX ANSI WINDOWS
# -----------------------
if os.name == "nt":
    os.system("")
    try:
        import ctypes
        kernel32 = ctypes.windll.kernel32
        kernel32.SetConsoleMode(kernel32.GetStdHandle(-11), 7)
    except:
        pass

# -----------------------
# KONFIGURASI UI
# -----------------------
SAVE_FILE = "suara_dilorong_save.json"
DIALOG_WIDTH = 70

class Color:
    BOLD = "\033[1m"
    END = "\033[0m"
    YELLOW = "\033[93m"
    GREEN = "\033[92m"
    CYAN = "\033[96m"
    RED = "\033[91m"
    DIM = "\033[2m"
    ITALIC = "\033[3m"
CHAR_PROFILE = {
    "ADRIAN": {"color": Color.CYAN, "cps": 80, "pitch": 900, "dur": 18, "style": "normal"},
    "FIRDAUS": {"color": Color.GREEN, "cps": 70, "pitch":1200, "dur": 15, "style": "whisper"},
    "ALEX": {"color": Color.RED, "cps":110, "pitch":600, "dur": 20, "style": "angry"},
    "PAK BUDI": {"color": Color.YELLOW, "cps": 60, "pitch": 800, "dur": 15, "style": "normal"},
    "BALQIS": {"color": Color.CYAN, "cps": 85, "pitch": 1000, "dur": 16, "style": "normal"},
    "DAFIR": {"color": Color.DIM, "cps": 65, "pitch": 1100, "dur": 14, "style": "whisper"},
    "DIANIRA": {"color": Color.YELLOW, "cps": 75, "pitch": 950, "dur": 17, "style": "normal"},
    "KILAU": {"color": Color.GREEN, "cps": 80, "pitch": 900, "dur": 16, "style": "normal"},
    "MAUL": {"color": Color.CYAN, "cps": 70, "pitch": 850, "dur": 15, "style": "normal"},
    "SPARTAN": {"color": Color.GREEN, "cps": 70, "pitch":1200, "dur": 15, "style": "normal"},
    "BU MADRINAH": {"color": Color.YELLOW, "cps": 60, "pitch": 800, "dur": 15, "style": "normal"},
    "PAK FIRMAN": {"color": Color.YELLOW, "cps": 60, "pitch": 800, "dur": 15, "style": "normal"},
    "PAK UDIN": {"color": Color.YELLOW, "cps": 60, "pitch": 800, "dur": 15, "style": "normal"},
    "MAK NYAK": {"color": Color.YELLOW, "cps": 60, "pitch": 800, "dur": 15, "style": "normal"},
    "RUSYDAN": {"color": Color.CYAN, "cps": 80, "pitch": 900, "dur": 16, "style": "normal"},
    "VARA": {"color": Color.DIM, "cps": 65, "pitch": 1100, "dur": 14, "style": "whisper"},
    "NITA": {"color": Color.DIM, "cps": 65, "pitch": 1100, "dur": 14, "style": "whisper"},
    "MICHAEL": {"color": Color.RED, "cps":100, "pitch":650, "dur": 19, "style": "angry"},
    "PRATAMA": {"color": Color.RED, "cps": 95, "pitch": 700, "dur": 18, "style": "normal"},
    "DAKA": {"color": Color.GREEN, "cps": 80, "pitch": 900, "dur": 16, "style": "normal"},
    "TRISTAN": {"color": Color.DIM, "cps": 65, "pitch": 1100, "dur": 14, "style": "whisper"},
    "GITA": {"color": Color.CYAN, "cps": 85, "pitch": 950, "dur": 16, "style": "normal"},
    "LEYA": {"color": Color.CYAN, "cps": 80, "pitch": 900, "dur": 16, "style": "normal"},
    "AMELIA": {"color": Color.CYAN, "cps": 80, "pitch": 900, "dur": 16, "style": "normal"},
    "KHENZA": {"color": Color.YELLOW, "cps": 75, "pitch": 950, "dur": 17, "style": "normal"},
    "FELIS": {"color": Color.CYAN, "cps": 80, "pitch": 900, "dur": 16, "style": "normal"},
    "BALDI": {"color": Color.YELLOW, "cps": 90, "pitch": 850, "dur": 16, "style": "normal"},
    "ARNOV": {"color": Color.GREEN, "cps": 80, "pitch": 900, "dur": 16, "style": "normal"},
    "GHIFARI": {"color": Color.GREEN, "cps": 80, "pitch": 900, "dur": 16, "style": "normal"},
    "NARASI": {"color": Color.YELLOW, "cps":75, "pitch": 0, "dur": 0, "style": "narration"},
    "DEFAULT": {"color": Color.CYAN, "cps":80, "pitch": 800, "dur": 18, "style": "normal"},
}

def apply_style(text: str, style: str) -> str:
    """Apply text styling based on style parameter"""
    return text

def cls():
    os.system('cls' if os.name == 'nt' else 'clear')
    print("\n" * 3)

def get_terminal_size():
    try:
        cols, _ = os.get_terminal_size()
        return min(max(cols, 80), 120)
    except:
        return 100

# -----------------------
# DIALOG BOX
# -----------------------
def narrate(text: str):
    prof = CHAR_PROFILE.get("NARASI", CHAR_PROFILE["DEFAULT"])
    color = prof["color"]
    cps = prof["cps"]

    # Bersihkan layar SEKALI DI AWAL
    cls()

    raw_lines = [line.strip() for line in text.split('\n') if line.strip()]
    full_lines = []

    for raw_line in raw_lines:
        current = ""
        for char in raw_line:
            current += char
            # HAPUS LAYAR DULU → baru gambar box → cuma 1 box!
            cls()
            draw_dialog_box(full_lines + [current + "█"], "NARASI", color)
            time.sleep(1.0 / cps)
        full_lines.append(raw_line)

    # Setelah selesai → tampilkan full + tunggu Enter
    cls()
    draw_dialog_box(full_lines, "NARASI", color)
    input()
    cls()

def say(speaker: str, text: str):
    """Display character dialogue"""
    lines = text.split('\n')
    slow_print_dialog('\n'.join(lines), speaker)

def choice_prompt(options: List[str]) -> int:
    """Display a choice menu and return selected option number (1-indexed)"""
    return choice_menu(options, "PILIHAN") 

def slow_print_center(text: str, wait: bool = False):
    """Print centered text slowly"""
    cls()
    width = get_terminal_size()
    print(text.center(width))
    if wait:
        input()

# GANTI SELURUH FUNGSI draw_dialog_box() JADI YANG INI:
def draw_dialog_box(text_lines: List[str], title: str = "", title_color: str = ""):
    width = get_terminal_size()
    box_w = min(DIALOG_WIDTH, width - 10)
    left_pad = (width - box_w) // 2
    inner_w = box_w - 4  # lebar dalam box

    print("\n" * 2)
    print(" " * left_pad + "╔" + "═" * (box_w - 2) + "╗")
    
    if title:
        title_line = f" {title.upper()} ".center(box_w - 4)
        color = title_color if title_color else Color.YELLOW
        print(" " * left_pad + "║" + Color.BOLD + color + title_line + Color.END + "║")
        print(" " * left_pad + "║" + " " * (box_w - 2) + "║")

    # AUTO WRAP KALIMAT PANJANG!
    for raw_line in text_lines:
        wrapped = textwrap.wrap(raw_line, inner_w)
        for line in wrapped:
            print(" " * left_pad + "║ " + line.ljust(inner_w) + " ║")
        # Kalau ada baris kosong di asli, beri jarak
        if not wrapped:
            print(" " * left_pad + "║ " + " " * inner_w + " ║")

    print(" " * left_pad + "╚" + "═" * (box_w - 2) + "╝")
    print(" " * (width - 30) + f"{Color.BOLD}{Color.GREEN}[ ENTER ]{Color.END}")

def slow_print_dialog(text: str, speaker: str = "NARASI"):
    # Ambil data karakter
    prof = CHAR_PROFILE.get(speaker.upper(), CHAR_PROFILE["DEFAULT"])
    color = prof["color"]
    cps = prof["cps"]        # karakter per detik
    style = prof["style"]

    # Fungsi portrait di sebelah kanan
    def show_portrait():
        if speaker.upper() not in PORTRAIT:
            return
        lines = PORTRAIT[speaker.upper()]
        width = get_terminal_size()
        portrait_w = 25
        left_pad = width - portrait_w - 10
        print("\n" * 5)
        for line in lines:
            print(" " * left_pad + Color.BOLD + color + line.center(portrait_w) + Color.END)

    # Refresh layar tiap huruf
    def refresh():
        cls()
        show_portrait()
        draw_dialog_box(full_lines + [current + "█"], speaker.upper(), color)

    # Siapkan teks
    raw_lines = [line.strip() for line in text.split('\n') if line.strip()]
    full_lines = []
    current = ""

    # Efek ketik
    for raw_line in raw_lines:
        styled = apply_style(raw_line, style)
        current = ""
        for char in styled:
            current += char
            refresh()
            time.sleep(1.0 / cps)
        full_lines.append(styled)

    # Tampilkan hasil akhir
    cls()
    show_portrait()
    draw_dialog_box(full_lines, speaker.upper(), color)
    input()
    cls()
# -----------------------
# ASCII ART SELINGAN
# -----------------------
ASCII_ARTS = {
    "intro": [

        " ██████╗ ██╗   ██╗████████╗███████╗██╗██████╗ ███████╗██████╗  ",
        "██╔═══██╗██║   ██║╚══██╔══╝██╔════╝██║██╔══██╗██╔════╝██╔══██╗ ",
        "██║   ██║██║   ██║   ██║   ███████╗██║██║  ██║█████╗  ██████╔╝ ",
        "██║   ██║██║   ██║   ██║   ╚════██║██║██║  ██║██╔══╝  ██╔══██╗ ",
        "╚██████╔╝╚██████╔╝   ██║   ███████║██║██████╔╝███████╗██║  ██║ ",
        " ╚═════╝  ╚═════╝    ╚═╝   ╚══════╝╚═╝╚═════╝ ╚══════╝╚═╝  ╚═╝ ",                                                                                                                
                                                                                                                                                                             
    ],
    "school": [   

"        ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒        ",
"       ▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░▓       ",
"      ▓░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░▓      ",
"     ▒▒▒▒▒▒▒▒ ░░ ░░░░▒ ░▒▒▒▒░▓     ",
"    ▓▒▒▒░▒░ ▒▒▒▒▒▒▒▒▒▒░░ ░▒▒▒ ▓    ",
"   ▓▒▒    ▒▒▓▒▓░░░░░▓▒▓▒▒▒ ▒▒▒░▓   ",
"  ▓░▒   ▒▒▒▒▓▒░░░░░░░▒▓▒▒▒▒▒ ░▒░▓  ",
" ▓░▒▒▒▒▒▒▒▒▒▓▓▒▓░░░▓▒▓▓▒▒▒▒▒▒▒▒▒░▓ ",
" ▓░▒▒▒▒▒▒▒▒▒▒▓▓▓▒▒▒▓▓▓▒▒▒▒▒▒▒▒▒▒░▓ ",
" ░▓░▒▒▒▒▒▒▒▒▒▓▓▒▒▒▒▒▓▓▒▒▒▒▒▒▒▒▒░▓░ ",
"  ░▒▒▒▒▒▒▒▒▒▓▓▓▒▒▒▒▒▓▓▓▒▒▒▒▒▒▒▒▒░  ",
"   ▓░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░▓   ",
"    ▓░▒▒▒▒▒▒░▒▒░░▒░▒░░▒▒▒▒▒▒▒▒▓    ",
"    ░▓▒▒▒▒▒▓▓▓▓▒▒▒▒▒▓▓▓▓▒▒▒▒▒▓░    ",
"     ░▒▒▒▒▒▒▒░▒▓▓▓▓▓▒░░▒▒▒▒▒ ▓     ",
"      ▓ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░▓      ",
"       ▓▓▓▓▓▓▒░▒░▒▓▓▒▒▒░▓▓▓▓░      ",
"        ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓       "
"                                    "
"                                    ",
"      S M A N | 0 1 |B A T U       ",
                                   
    ],
    "kelas": [
    "             _I_                                               ",
    "           .~'_`~.                                             ",
    "     /(  ,^ .~ ~. ^.  )                                        ",
    "     \ \/ .^ |   ^. \/ /                                       ",
    "      Y  /   |     \  Y            ___.oOo.___                ",
    "      | Y    |      Y |           |           |               ",
    "      | |    |      | |           |           |               ",
    "      | |   _|___   | |           |           |               ",
    "      | |  /____/|  | |           |           |               ",
    "      |.| |   __/|__|.|           |           |               ",
    "      |.| |   __/|  |.|          _|___________|_              ",
    "      |:| |   __//  |:|         '^^^^^^^^^^^^^^^`              ",
    "      |:| |_____/   |:|                                        ",
    "  ____|_|/          |_|_____________________________           ",
    "  ____]H[           ]H[_____________________________           ",
    
    ],

    "gerbang": [
     [
    "                          {} {}",
    "                            !  !  II II  !  !",
    "                         !  I__I__II II__I__I  !",
    "                         I_/|--|--|| ||--|--|\\_/I",
    "        .-'\"'-.       ! /|_/|  |  || ||  |  |\\_|\ !       .-'\"'-.",
    "       /===    \\      I//|  |  |  || ||  |  |  |\\\\I      /===    \\",
    "       \\==     /   ! /|/ |  |  |  || ||  |  |  | \\|\\ !   \\==     /",
    "        \\__  _/    I//|  |  |  |  || ||  |  |  |  |\\\\I    \\__  _/",
    "         _} {_  ! /|/ |  |  |  |  || ||  |  |  |  | \\|\\ !  _} {_",
    "        {_____} I//|  |  |  |  |  || ||  |  |  |  |  |\\\\I {_____}",
    "   !  !  |=  |=/|/ |  |  |  |  |  || ||  |  |  |  |  | \\|\\=|-  |  !  ! ",
    "  _I__I__|=  ||/|  |  |  |  |  |  || ||  |  |  |  |  |  |\\||   |__I__I_",
    "  -|--|--|-  || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||=  |--|--|-",
    "  _|__|__|   ||_|__|__|__|__|__|__|| ||__|__|__|__|__|__|_||-  |__|__|_,",
    "  -|--|--|   ||-|--|--|--|--|--|--|| ||--|--|--|--|--|--|-||   |--|--|- ",
    "   |  |  |=  || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||   |  |  | ",
    "   |  |  |   || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||=  |  |  | ",
    "   |  |  |-  || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||   |  |  | ",
    "   |  |  |   || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||=  |  |  |",
    "   |  |  |=  || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||   |  |  |",
    "   |  |  |   || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||   |  |  |",
    "   |  |  |   || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||-  |  |  |",
    "  _|__|__|   || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||=  |__|__|_,",
    "  -|--|--|=  || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||   |--|--|-",
    "  _|__|__|   ||_|__|__|__|__|__|__|| ||__|__|__|__|__|__|_||-  |__|__|_,",
    "  -|--|--|=  ||-|--|--|--|--|--|--|| ||--|--|--|--|--|--|-||=  |--|--|-",
    "  -|--|--|-  || |  |  |  |  |  |  || ||  |  |  |  |  |  | ||-  |  |  |",
    " ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^~~~~~~~~~~~",
]
    ],

    "toilet":
  [
    "|; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ;|",
    "| ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; |",
    "|; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ;|",
    "| ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; |",
    "|; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ;|",
    "| ;_; ||==========||==========||=============||=============||;_; ; ___ ; ;_; |",
    "|;/_\\;||          ||          ||             ||             ||/_\\; /   \\ ;/_\\;|",
    "| =|= ||   ~()    ||   ~()    ||_____________||_____________||=|= | //  | =|= |",
    "|; ; ;||    ||    ||    ||    ||             ||             || ; ;|     |; ; ;|",
    "| ; ; ||    ||    ||    ||    |:]            |:]            ||; ; ;\\___/; ; ; |",
    "|=====||  ..||..  ||  ..||..  ||             ||             ||================|",
    "|     || //\"II\"\\\\ || //\"II\"\\\\ ||           ~:||           ~:||    ___/___     |",
    "|     || || '' || || || '' || ||             ||             ||  / .-T|T-. \\   |",
    "|     || ||    || || ||    || ||             ||             || /_'-------'_\\  |",
    "|     || ||____|| || ||____|| |:]            |:]            || |  ___ ___  |  |",
    "|     ||  \\____/  ||  \\____/  ||_____________||_____________|| | |   |   | |  |",
    "|     ||          ||          ||    \\| |/    ||    \\| |/    || | |  {|}  | |  |",
    "'-----||-.------.-||-.------.-||-.---|_|---.-||-.---|_|---.-||-| |   |   | |--' ",
    "      ||/________\\||/________\\||/___________\\||/___________\\lc |_|___|___|_|",
],

    "kelas":
[
    "                 _I_",
    "               .~'_`~.",
    "         /(  ,^ .~ ~. ^.  )\\",
    "         \\ \\/ .^ |   ^. \\/ /",
    "          Y  /   |     \\  Y            ___.oOo.___ ",
    "          | Y    |      Y |           |           |",
    "          | |    |      | |           |           |",
    "          | |   _|___   | |           |           |",
    "          | |  /____/|  | |           |           |",
    "          |.| |   __/|__|.|           |           |",
    "          |.| |   __/|  |.|          _|___________|_",
    "          |:| |   __//  |:|         '^^^^^^^^^^^^^^^`",
    "          |:| |_____/   |:|",
    "      ____|_|/          |_|_____________________________",
    "      ____]H[           ]H[_____________________________",
    "           /             \\",
],

    "ruang bk": 
  [
    "    		   _____________________________",
    "                  |`._________________________, |",
    "                  | |                         | |",
    "                  | |          /~\\/\\,,         | | ",
    "                  | |        /~/\\ /\\/~\\       | |  ",
    "                  | |       (~// ~\\//\\_)      | |",
    "                  | |      _/\\\\ \\{@}/ /_)     | |",
    "                  | |   ...\\\\ \\~___~/__/'`'.  | | ",
    "                  | |  `.,. \\_(_/ ~\\/   .'   | | ",
    "                  | |      `'..'`\\/`'...'     | |",
    "                  | |_________________________| |",
    "                  |,__________________________`.|",
    "                   _____________   _____________  ",
    "              ___.'             '.'             '.___ ",
    "      _._    (   |               :               |   )    _._ ",
    "     /   \\    \\  |               :               |  /    /   \\ ",
    "    /_____\\    )_____            :            _____(    /_____\\ ",
    "      ( )      /\\%%%%\\           :           /%%%%/\\      ( ) ",
    "   ___/_\\___  / /\\%%%%\\__________:__________/%%%%/\\ \\  ___/_\\___",
    "lc_||__*__||_(=) /\\%%%%\\         .         /%%%%/\\ (=)_||__*__||___ ",
    "   ||     || || /_______________/ \\_______________\\ || ||     || ",
    "   ||     || ||'._______________.'._______________.'|| ||     || ",
    "             ||_____________________________________||  ",
    "             ||_____________________________________|| ",
    "             []LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL[] ",
    "             .;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;.",
    "            :;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:",
    "             '::::::::::::::::::::::::::::::::::::::::'",
],

"locker": [
    "     _________________________________________________________________",
    "    |/////////////////////////////////////////////////////////////////|",
    "    |/////////////////////////////////////////////////////////////////|",
    "    |-----------------------------------------------------------------|",
    "    ||   _________   ||   _________   ||   _________   ||            |",
    "    ||  |         |  ||  |         |  ||  |         |  ||            |",
    "    ||  |  #####  |  ||  |  #####  |  ||  |  #####  |  ||            |",
    "    ||  |  #####  |  ||  |  #####  |  ||  |  #####  |  ||            |",
    "    ||  |_________|  ||  |_________|  ||  |_________|  ||            |",
    "    ||               ||               ||               ||            |",
    "    ||  ___________  ||  ___________  ||  ___________  ||            |",
    "    || |           | || |           | || |           | ||            |",
    "    || |           | || |           | || |           | ||            |",
    "    || |           | || |           | || |           | ||            |",
    "    || |___________| || |___________| || |___________| ||            |",
    "    ||               ||               ||               ||            |",
    "    ||   ________    ||   ________    ||   ________    ||            |",
    "    ||  |  ____ |    ||  |  ____ |    ||  |  ____ |    ||            |",
    "    ||  | |    ||====||  | |    ||====||  | |    ||====||            |",
    "    ||  | |____||    ||  | |____||    ||  | |____||    ||            |",
    "    ||  |________|    ||  |________|    ||  |________|  ||            |",
    "    ||               ||               ||               ||             |",
    "    |-----------------------------------------------------------------|",
    "    |_________________________________________________________________|",
],

"perpus":

[
    "     ____________________________________________________",
    "    |____________________________________________________|",
    "    | __     __   ____   ___ ||  ____    ____     _  __  |",
    "    ||  |__ |--|_| || |_|   |||_|**|*|__|+|+||___| ||  | |",
    "    ||==|^^||--| |=||=| |=*=||| |~~|~|  |=|=|| | |~||==| |",
    "    ||  |##||  | | || | |JRO|||-|  | |==|+|+||-|-|~||__| |",
    "    ||__|__||__|_|_||_|_|___|||_|__|_|__|_|_||_|_|_||__ |_|",
    "    ||_______________________||__________________________|",
    "    | _____________________  ||      __   __  _  __    _ |",
    "    ||=|=|=|=|=|=|=|=|=|=|=| __..\\/ |  |_|  ||#||==|  / /|",
    "    || | | | | | | | | | | |/\\ \\  \\\\|++|=|  || ||==| / / |",
    "    ||_|_|_|_|_|_|_|_|_|_|_/_/\\_.___\\__|_|__||_||__|/_/__|",
    "    |____________________ /\\~()/()~//\\ __________________|",
    "    | __   __    _  _     \\_  (_ .  _/ _    ___     _____|",
    "    ||~~|_|..|__| || |_ _   \\ //\\\\ /  |=|__|~|~|___| | | |",
    "    ||--|+|^^|==|1||2| | |__/\\ __ /\\__| |==|x|x|+|+|=|=|=|",
    "    ||__|_|__|__|_||_|_| /  \\ \\  / /  \\_|__|_|_|_|_|_|_|_|",
    "    |_________________ _/    \\/\\/\\/    \\_ _______________|",
    "    | _____   _   __  |/      \\../      \\|  __   __   ___|",
    "    ||_____|_| |_|##|_||   |   \\/ __|   ||_|==|_|++|_|-|||",
    "    ||______||=|#|--| |\\   \\   o    /   /| |  |~|  | | |||",
    "    ||______||_|_|__|_|_\\   \\  o   /   /_|_|__|_|__|_|_|||",
    "    |_________ __________\\___\\____/___/___________ ______|",
    "    |__    _  /    ________     ______           /| _ _ _|",
    "    |\\ \\  |=|/   //    /| //   /  /  / |        / ||%|%|%|",
    "    | \\/\\ |*/  .//____//.//   /__/__/ (_)      /  ||=|=|=|",
    "  __|  \\/\\|/   /(____|/ //                    /  /||~|~|~|__",
    "    |___\\_/   /________//   ________         /  / ||_|_|_|",
    "    |___ /   (|________/   |\\_______\\       /  /| |______|",
    "        /                  \\|________)     /  / | |",
], 

    "laboratorium kimia":   
[
    "__ _____ ____ _____ ______ _______ _____ ______ ______ ______ ___",
    "__]_____]____]_____]______]_______]_____]______]______]______]___]",
    "             _                       _______  |||\"||;;|.||##||=|||",
    "  _                           _     |   *  3| |||-|| =|-||==||+|||",
    "  ____________       _              |       | |||_||__|_||__||_|||",
    "|`.   --__     `.        _______    |       | ||================||",
    "|  `._____________`.  .'|.-----.|   _ ======| ||| | -|&|^^|!!|-|||",
    "|   | .-----------.| |  ||     ||  (o))   _ | ||| |**|=|+-|##|=|||",
    "|   | |  .-------.|| |  ||     ||  /||   / \\`._|  .-.|_|__|__|_|||",
    "|   | |  |       |||_`..|'_____'| //||___\\_/.'\\| (( ))==========||",
    "|   | |`.|  ==== ||| | `---------(o)||         \\  /-'-=|+|.-|-'|||",
    "|`. | |`.|_______|||/|______________||__.--._ (o)/|=|;:|-|&&|&&|||",
    "|  `|_|===========||_|                 (____)-.'(o)_|__|_|__|__|||",
    "|   | |  .-------.||                           `._\\=============||",
    "|   | |  |       |||                             `.     |       ||",
    "|   | |`.|  ==== |||`._____________________________`.  o|o      ||",
    "|`. | |`.|_______||| |._.----------------.__.-------.|__|_______||",
    "|  `|_|===========|| || '----------------'  | .---. ||  __",
    "|   | |  .-------.|| ||               |     |_______||.'\\.'.",
    "|   | |  |       ||| || ______________|     | .---. ||'.__.'",
    "|   | |`.|  ==== ||| ||                `.   |_______|||  _ |",
    " `. | |`.|_______||| ||                  `. | .---. |||_  ||",
    "   `|_|========LGB||`||                    `|_______|||____|",
    "                       `.                    `.",
    "                         `.____________________`.",
],

    "gudang olahraga":
[
    "                .-.__",
    "                                          (     `-.",
    "                                           [`--.__ )",
    "                                           | ][  ]/",
    "                                          .--.][_|",
    "                                         /        `----.______",
    "                     _.-----------------'                     `---------------.",
    "                   .'                                                          \\",
    "                   |                                                            |",
    "                   |                                                            |",
    "                   |                                                            |",
    "                   |                                                            |",
    "                   |                                                            |",
    "                   |                                                            |",
    "                   |                                                            |",
    "                   |                                                            |",
    "                   |                                                            |",
    "                    \\                                                           |",
    "                     `-._______________                  _.-------._            |",
    "                      | |              `-.   .----------'           `.          |",
    "                      | |   _________     \\ / __________       ______\\_        |",
    "                      | |  |   |||   |     Y |/////\\\\\\\\\\|     |   |||  `.      /",
    "                      | |  |   |||   |     | |/////\\\\\\\\\\|     |   |||   |`-.__/",
    "                      | |  |____|____|       |/////\\\\\\\\\\|     |____|____|   | |",
    "  VK                  | |  | ,,,| \\  |       |////  \\\\\\\\\\|     |  / | \\  |   | |",
    "                      | |  |(o o|  \\ |       |///\\  /\\\\\\|     | /  |  \\ |   | |",
    "                      | |  |____|____|       |////\\/\\\\\\\\|     |____|____|   | |",
    "`-------._______      | |  |/   |,,, |       |o==//\\\\\\\\\\|     | \\  |  / |   | |____.---------",
    "                `----.| |__|.---|o o)|       |@////\\\\\\\\\\|     |  \\_|__.------'",
    "               _.------'          `--+------.|/////\\\\\\\\\\|_.---+--'",
    "----.___.-----'                                                                _________.----",
    "                             _.------------.________________.-----------------'",
],


    "kantin":
[
    "0==============================================================0",
    "|'. (|) .'|",
    "| '. | .' |",
    "| '. |O| .' |",
    "| '. _____________ /===\\ _____________ .' |",
    "| : `\\ /\"\\\"/`\\ /\"\\\"/` : |",
    "| : m m m m m V V V _________ : |",
    "| : | | | | | @@@ |-------| : |",
    "| : |-| |-| | @@@@@@@ |%%%%%%%| : |",
    "| : |_| |_|_| @@@ |_______| : |",
    "| : \\|/ ____ : |",
    "| :;; .'``(_)```. /____\\ .''; : |",
    "| :||___ :==========================: | || : |",
    "| :||===) | [] [] [] [] [] | | || : |",
    "| ://``\\\\_|___________________________|__|/\\\\_: |",
    "| .'/' \\' | ____ ____ | '.'. |",
    "| .' | .' '. / '. | '. |",
    "| .' | ____ | || | ____ | '. |",
    "|.' | |____|| || ||____| | '. |",
    "|================| | | |______||______|| | | |==========| |",
    "| _____ | | | ____ ____ | | | _____ |",
    "| /     \\ | | | |    |    | | | | | /     \\ |",
    "| /     \\ | |__| |____| |____| | |__| /     \\ |",
    "0==============================================================0",
],

    "lorong":

[
    "|.'.'',                                 ,''.'.|",
    "|.'.''. '',                             ,''.'.'.|",
    "|.'.''. ''. '',                         ,''.'.'.'.|",
    "|.'.''. ''. '|                         |.'.'.'.'.|",
    "|.'.''. ''. '|===;                 ;===|.'.'.'.'.|",
    "|.'.''. ''. '|:::|',             ,'|:::|.'.'.'.'.|",
    "|.'.''. ''. '|---|'.|, _______ ,|.'|---|.'.'.'.'.|",
    "|.'.''. ''. '|:::|'.|'|???????|'|.'|:::|.'.'.'.'.|",
    "|,',',',',|---|',|'|???????|'|,'|---|,',',',',|",
    "|.'.''. ''. '|:::|'.|'|???????|'|.'|:::|.'.'.'.'.|",
    "|.'.''. ''. '|---|','   /%%%\   ','|---|.'.'.'.'.|",
    "|.'.''. ''. '|===:'    /%%%%%\    ':===|.'.'.'.'.|",
    "|.'.''. ''. '|%%%%%%%%%%%%%%%%%%%%%%%%%|.'.'.'.'.|",
    "|.'.''. ''. ','       /%%%%%%%%%\       ','.'.'.'.|",
    "|.'.''. ','        /%%%%%%%%%%%\        ','.'.'.|",
    "|.'.','         /%%%%%%%%%%%%%\         ','.'.|",
    "|.','          /%%%%%%%%%%%%%%%\          ','.|",
    "|;____________/%%%%%Spicer%%%%%%\____________;|",
    "                                                        ",
],
    "rumah dafir":
    [
    "             (",
    "                )",
    "            (            ./\\.",
    "         |^^^^^^^^^|   ./LLLL\\.",
    "         |`.'`.`'`'| ./LLLLLLLL\\.",
    "         |.'`'.'`.'|/LLLL/^ ^\\LLLL\\.",
    "         |.`.''``./LLLL/^ () ^\\LLLL\\.",
    "         |.'`.`./LLLL/^  =   = ^\\LLLL\\.",
    "         |.`../LLLL/^  _.----._  ^\\LLLL\\.",
    "         |'./LLLL/^ =.' ______ `.  ^\\LLLL\\.",
    "         |/LLLL/^   /|--.----.--|\\ = ^\\LLLL\\.",
    "       ./LLLL/^  = |=|__|____|__|=|    ^\\LLLL\\.",
    "     ./LLLL/^=     |*|~~|~~~~|~~|*|   =  ^\\LLLL\\.",
    "   ./LLLL/^        |=|--|----|--|=|        ^\\LLLL\\.",
    " ./LLLL/^      =   `-|__|____|__|-' =        ^\\LLLL\\.",
    "/LLLL/^   =         `------------'        =    ^\\LLLL\\",
    "~~|.~       =        =      =          =         ~.|~~",
    "  ||     =      =      = ____     =         =     ||",
    "  ||  =               .-'    '-.        =         ||",
    "  ||     _..._ =    .'  .-()-.  '.  =   _..._  =  ||",
    "  || = .'_____`.   /___:______:___\\   .'_____`.   ||",
    "  || .-|---.---|-.   ||  _  _  ||   .-|---.---|-. ||",
    "  || |=|   |   |=|   || | || | ||   |=|   |   |=| ||",
    "  || |=|___|___|=|=  || | || | ||=  |=|___|___|=| ||",
    "  || |=|~~~|~~~|=|   || | || | ||   |=|~~~|~~~|=| ||",
    "  || |*|   |   |*|   || | || | ||  =|*|   |   |*| ||",
    "  || |=|---|---|=| = || | || | ||   |=|---|---|=| ||",
    "  || |=|   |   |=|   || | || | ||   |=|   |   |=| ||",
    "  || `-|___|___|-'   ||o|_||_| ||   `-|___|___|-' ||",
    "  ||  '---------`  = ||  _  _  || =  `---------'  ||",
    "  || =   =           || | || | ||      =     =    ||",
    "  ||  %@&   &@  =    || |_||_| ||  =   @&@   %@ = ||",
    "  || %@&@% @%@&@    _||________||_   &@%&@ %&@&@  ||",
    "  ||,,\\\\V//\\\\V//, _|___|------|___|_ ,\\\\V//\\\\V//,,||",
    "  |--------------|____/--------\\____|--------------|",
    " /- _  -  _   - _ -  _ - - _ - _ _ - _  _-  - _ - _ \\",
    "/____________________________________________________\\",
],

}

def show_ascii(art_key: str):
    art = ASCII_ARTS.get(art_key, ["???"])
    width = get_terminal_size()
    cls()
    print("\n" * 5)
    max_len = len(max(art, key=len))
    for line in art:
        print(" " * ((width - max_len) // 2) + Color.BOLD + Color.CYAN+ line + Color.END)
        time.sleep(0.1)
    time.sleep(1.5)
    input(f"\n{' ' * ((width - 20) // 2)}[{Color.GREEN}ENTER lanjut{Color.END}]\n")
    cls()

# -----------------------
# CHOICE MENU (BOXED)
# -----------------------
def choice_menu(options: List[str], title: str = "PILIHAN"):
    while True:
        cls()
        # Gabungkan semua opsi jadi satu list yang rapih
        display_lines = [f"{i+1}. {opt}" for i, opt in enumerate(options)]
        draw_dialog_box(display_lines, title, Color.GREEN)
        
        print(f"\n{' ' * 30}{Color.BOLD}{Color.CYAN}Masukkan angka (1-{len(options)}): {Color.END}", end="")
        sel = input().strip()
        
        if sel.isdigit() and 1 <= int(sel) <= len(options):
            cls()
            return int(sel)
        else:
            narrate("Pilihan tidak valid! Masukkan angka yang benar.")
            time.sleep(1)

# -----------------------
# SAVE SYSTEM
# -----------------------
def save_game(data: dict):
    with open(SAVE_FILE, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

def load_save() -> dict:
    if os.path.exists(SAVE_FILE):
        try:
            with open(SAVE_FILE, 'r', encoding='utf-8') as f:
                return json.load(f)
        except:
            return {}
    return {}

def delete_save():
    if os.path.exists(SAVE_FILE):
        os.remove(SAVE_FILE)

# -----------------------
# MENU OLDENRPG
# -----------------------
LOGO = [

        " ██████╗ ██╗   ██╗████████╗███████╗██╗██████╗ ███████╗██████╗  ",
        "██╔═══██╗██║   ██║╚══██╔══╝██╔════╝██║██╔══██╗██╔════╝██╔══██╗ ",
        "██║   ██║██║   ██║   ██║   ███████╗██║██║  ██║█████╗  ██████╔╝ ",
        "██║   ██║██║   ██║   ██║   ╚════██║██║██║  ██║██╔══╝  ██╔══██╗ ",
        "╚██████╔╝╚██████╔╝   ██║   ███████║██║██████╔╝███████╗██║  ██║ ",
        " ╚═════╝  ╚═════╝    ╚═╝   ╚══════╝╚═╝╚═════╝ ╚══════╝╚═╝  ╚═╝ ",    
                                                                                   
    "",
    " S M A N | 0 1 |B A T U",
    " © 2025 CLI Interactive Story",
    "",
    " Sebuah cerita tentang pilihan, empati, dan kegelapan",
]

def draw_menu(options: List[str], selected: int, show_save_hint: bool = True):
    cls()
    print()
    for i, line in enumerate(LOGO):
        if i == 7:
            print(Color.BOLD + Color.YELLOW + line.center(85) + Color.END)
        elif i == 8:
            print(Color.CYAN + line.center(85) + Color.END)
        else:
            print(line.center(85))
    print()
    print(" " * 35 + "v2.0.0".rjust(20))
    print(" " * 35 + "By Raffa Danendra & Davin Varian".rjust(25))
    print("\n" * 2)
    for i, opt in enumerate(options):
        prefix = " > " if i == selected else "   "
        color = Color.BOLD + Color.GREEN if i == selected else ""
        print(f"{' ' * 38}{prefix}{color}{opt}{Color.END}")
    print()
    if show_save_hint:
        print(f"{Color.RED}Press 'DEL' to erase save data{Color.END}".center(85))
    print(f"{Color.CYAN}Use arrow keys to move, 'ENTER' to select{Color.END}".center(85))

def get_key():
    if os.name == "nt":
        import msvcrt
        if msvcrt.kbhit():
            key = msvcrt.getch()
            if key == b'\xe0':
                key2 = msvcrt.getch()
                if key2 == b'H': return "UP"
                if key2 == b'P': return "DOWN"
            elif key == b'\r': return "ENTER"
            elif key in (b'\x08', b'\x7f'): return "DEL"
            elif key == b'q': return "Q"
    else:
        import termios, tty
        old = termios.tcgetattr(sys.stdin)
        try:
            tty.setraw(sys.stdin.fileno())
            key = sys.stdin.read(1)
            if key == '\x1b':
                n1 = sys.stdin.read(1)
                if n1 == '[':
                    n2 = sys.stdin.read(1)
                    if n2 == 'A': return "UP"
                    if n2 == 'B': return "DOWN"
            elif key == '\r': return "ENTER"
            elif key == '\x7f': return "DEL"
            elif key == 'q': return "Q"
        finally:
            termios.tcsetattr(sys.stdin, termios.TCSADRAIN, old)
    return ""

def settings_menu():
    opts = ["Sound: OFF", "Text Speed: Normal", "Back"]
    sel = 0
    while True:
        cls()
        draw_dialog_box(opts, "SETTINGS", Color.CYAN)
        print("\n" + " Gunakan ↑↓ dan ENTER ".center(80))
        key = get_key()
        if key == "UP" and sel > 0: sel -= 1
        if key == "DOWN" and sel < 2: sel += 1
        if key == "ENTER":
            if sel == 2:  # Back
                return  # kembali ke intro_menu
            else:
                narrate("Fitur ini belum tersedia.")
                time.sleep(1)

def intro_menu():
    options = ["Continue", "New Game", "Settings", "Quit"]
    selected = 0
    save_exists = os.path.exists(SAVE_FILE)
    if not save_exists:
        options[0] = "Continue (no save)"

    while True:
        cls()
        draw_menu(options, selected, show_save_hint=save_exists)
        key = get_key()

        if key == "UP" and selected > 0:
            selected -= 1
        elif key == "DOWN" and selected < len(options) - 1:
            selected += 1
        elif key == "ENTER":
            choice = options[selected].split()[0].lower()

            if choice == "quit":
                cls()
                print("Terima kasih telah bermain!".center(80))
                exit()

            elif choice == "settings":
                settings_menu()  # <--- NANTI KITA BIKIN
                continue  # <--- KEMBALI KE MENU UTAMA!

            elif choice == "continue":
                if save_exists:
                    return "continue"
                else:
                    narrate("Tidak ada save data!")
                    time.sleep(1)
                    continue

            elif choice == "new":
                delete_save()
                return "new"

        elif key == "DEL" and save_exists:
            delete_save()
            save_exists = False
            options[0] = "Continue (no save)"
            narrate("Save data telah dihapus!")
            time.sleep(1)

    
# -----------------------
# GAME STATE
# -----------------------
from collections import defaultdict

state = defaultdict(int)
state.update({
    # === TAMPILKAN DI RINGKASAN ===
    "moral": 0,                    # Tinggi = pahlawan | Rendah = penutup mata
    "pengaruh_negatif": 0,         # Tinggi = ikut geng Alex
    "persahabatan_firdaus": 0,     # Tinggi = sahabat Firdaus (pengaruh positif)
    "clue": 0,                     # Total bukti ditemukan

    # === INTERNAL (TIDAK DITAMPILKAN) ===
    "waspada": 0,
    "cuek": 0,
    "informasi_clue": 0,  
    "observasi": 0,
    "digital_clue": 0,
    "loker_hint": False,
    "investigasi": 0,
    "lokasi_investigasi": None,
    "hari_berganti": False,
    "dianira_notes": False,
    "kunci_tua": False,
    "lokertua_opened": False,
    "relasi_maul": 0,
    "relasi_spartan": 0,
    "usb": False,
    "alex_skeptis": False,
    "alex_menganggap_lemah": False,
    "alex_marah_besar": False,  
    "insight_sosial": False,
    "korban_dibantu": False,
    "alex_ditangkap": False,
    "ending_route": None
    
})


# -----------------------
# GAME SCENES (DENGAN VISUAL NOVEL UI)
# -----------------------
# ==============================
def pre_intro_opening():
    show_ascii("intro")       
    time.sleep(1)
    show_ascii("school")       
    time.sleep(1)

    narrate("Pagi itu, Adrian berdiri di depan gerbang SMA Negeri 01 Batu.")
    show_ascii("gerbang")       
    time.sleep(1)
    narrate("Gedung besar dengan cat krem, jendela tinggi, dan suara sepatu memenuhi udara.")
    narrate("Aroma kantin dan tawa para siswa bercampur jadi kesan pertama yang cukup mengintimidasi.")
    narrate("Namun bagi Adrian, ini cuma sekolah baru.")
    narrate("Beberapa hari sebelumnya, ia sempat mendapat pesan dari temannya, Arnov...")
    say("Arnov", "Bro, di SMA Negeri 01 Batu itu ada kenalanku yang kena bullying… hati-hati aja ya.")
    narrate("[ PILIHAN RESPON CHAT ARN0V ]")
    opsi = [
        '“Oke, makasih infonya, Arnov. Aku bakal hati-hati. Semoga nggak terlalu parah.” (Serius)',
        '“Hahaha, tenang aja. Aku nggak bakal ikut drama mereka kok. Gue cuma mau santai.” (Bercanda)',
        '“Ya udah, terserah mereka lah. Aku cuma mau masuk sekolah baru aja.” (Santai / Cuek)'
    ]
    pilih = choice_prompt(opsi)
    if pilih == 1:
        say("Adrian", "Oke, makasih infonya, Arnov. Aku bakal hati-hati.")
        state["waspada"] += 1
    elif pilih == 2:
        say("Adrian", "Hahaha, tenang aja. Aku nggak bakal ikut drama mereka kok.")
        state["waspada"] -= 1
    else:
        say("Adrian", "Ya udah, terserah mereka lah. Aku cuma mau masuk sekolah baru aja.")
        state["cuek"] += 1
    narrate("Adrian menyimpan ponselnya dan melangkah masuk ke gerbang sekolah.")
# ==============================
# ========== SCENE B ============
# ==============================
def meet_pak_budi_and_firdaus():
    slow_print_center("=== HARI PERTAMA ===", wait=True)
    show_ascii("DAY 1")    
    time.sleep(1)
    narrate("Adrian berjalan ke ruang guru. Seorang pria berwajah ramah menyapanya.")
    say("Pak Budi", "Selamat datang, Adrian! Aku Pak Budi, wali kelas kalian.")
    say("Pak Budi", "Ingat ya, di sini teman itu penting. Kalau ada masalah, jangan ragu ngobrol.")
    narrate("Dalam perjalanan ke kelas, Adrian bertabrakan dengan seorang siswa.")
    say("Firdaus", "Eh! Hati-hati, bro. Hampir bikin buku gue terbang.")
    say("Adrian", "Haha, maaf, nggak sengaja.")
    say("Firdaus", "Kamu murid baru kan? Aku Firdaus. Mau bareng masuk kelas?")
    narrate("[ PILIHAN INTERAKSI MEMPERKENALKAN DIRI ]")
    opsi = [
        "Kenal bercanda",
        "Kenal serius",
        "Santai"
    ]
    pilih = choice_prompt(opsi)
    if pilih == 1:
        say("Adrian", "Adrian, tapi panggil Ad aja. Jangan panggil aku bos kelas, haha.")
        say("Firdaus", "Hahaha, tenang bro. Asik ketemu orang humble.")
        state["persahabatan_firdaus"] += 1
    elif pilih == 2:
        say("Adrian", "Adrian. Senang bertemu. Semoga bisa nyambung di kelas.")
        say("Firdaus", "Iya, pasti. Aku bakal bantu kalau kamu butuh.")
        state["persahabatan_firdaus"] += 1
    else:
        say("Adrian", "Adrian. Gimana kabarnya?")
        say("Firdaus", "Baik. Semoga kamu nggak kaget sama keramaian di sini.")
        state["cuek"] += 1
    narrate("Mereka berjalan menuju kelas bersama.")
# ==============================
# ========== SCENE C ============
# ==============================
def seat_choice():
    narrate("Adrian memasuki kelas yang penuh dengan siswa bersama Firdaus.")
    show_ascii("kelas")       
    time.sleep(1)
    narrate("Kelas ramai. Firdaus menunjuk tiga tempat duduk yang tersisa.")
    narrate("[ PILIH TEMPAT DUDUK ]")
    opsi = [
        "Duduk sendiri di pojok",
        "Duduk di sebelah Firdaus",
        "Duduk di samping Alex"
    ]
    pilih = choice_prompt(opsi)
    if pilih == 1:
        narrate("Adrian memilih duduk sendiri. Ia menarik napas, menatap papan tulis.")
        seat = "alone"
    elif pilih == 2:
        narrate("Adrian duduk di sebelah Firdaus. Suasana terasa bersahabat.")
        seat = "firdaus"
        favorite_subject_scene()
    else:
        narrate("Adrian duduk di sebelah Alex, siswa dengan ekspresi penuh percaya diri.")
        seat = "alex"
        alex_intro_scene()
    return seat
def favorite_subject_scene():
    say("Firdaus", "Eh, btw, kamu suka pelajaran apa?")
    opsi = [
        "Olahraga",
        "Musik",
        "Matematika"
    ]
    pilih = choice_prompt(opsi)
    if pilih == 1:
        say("Adrian", "Olahraga. Terutama sepak bola, tim favoritku KING EMYU!.")
        say("Firdaus", "Wih, Manchester United ya! Aku Barcelona! Nanti kita adu Yamal vs Onana di kantin!")
        state["persahabatan_firdaus"] += 1
    elif pilih == 2:
        say("Adrian", "Musik. Lebih tenang kalau belajar sambil denger musik rock.")
        say("Firdaus", "Selera lo keren juga! Aku suka pop. Tukeran playlist nanti ya!")
        state["persahabatan_firdaus"] += 1
    else:
        say("Adrian", "Matematika. Aku suka banget sama materi limit sih.")
        say("Firdaus", "Oke, siap \"El Limit! Aku sering pusing aljabar. Nanti bantuin ya!")
        state["persahabatan_firdaus"] += 1
def alex_intro_scene():
    say("Alex", "Yo, murid baru. Gue Alex. Duduk sini, biar gue kenalin trik sekolah ini.")
    say("Alex", "Lo udah denger gosip apa tentang SMA Negeri 01 Batu?")
    opsi = [
        "Ikut iseng",
        "Cuek",
        "Tolak keras"
    ]
    pilih = choice_prompt(opsi)
    if pilih == 1:
        say("Adrian", "Gosip? Belum. Tapi gue siap dengerin trik-triknya.")
        say("Alex", "Nah, good boy. Lo pinter milih tempat.")
        state["pengaruh_negatif"] += 2
    elif pilih == 2:
        say("Adrian", "Gak ada gosip. Gue ke sini buat sekolah, bukan drama.")
        say("Alex", "Hahaha, semua orang bilang gitu di awal. Tapi lo bakal lihat nanti.")
    else:
        say("Adrian", "Makasih, tapi gue cuma mau tenang di sini.")
        say("Alex", "Oke, anak baru. Tapi jangan sampe lo jadi target ya.")
        state["pengaruh_negatif"] -= 1
# ==============================
# ========== SCENE D ============
# ==============================
def first_lesson(seat):
    narrate("Bel masuk berbunyi. Guru mulai pelajaran pertama.")
    if seat == "alone":
        narrate("Adrian fokus sendiri, mencoba memahami suasana kelas.")
    elif seat == "firdaus":
        narrate("Firdaus berbisik, meminta bantuan soal. Adrian membantunya.")
        state["persahabatan_firdaus"] += 1
    elif seat == "alex":
        narrate("Alex mencoba menyalin tugas. Adrian melihat dengan ragu.")
        opsi = ["Ikut menyalin", "Menolak halus"]
        pilih = choice_prompt(opsi)
        if pilih == 1:
            narrate("Adrian ikut menyalin tugas. Alex tersenyum puas.")
            state["pengaruh_negatif"] += 1
        else:
            narrate("Adrian menolak halus. Alex hanya mendengus.")
# ==============================
# ========== SCENE E ============
# ==============================
def break_time(seat):
    narrate("Bel istirahat berbunyi. Suasana kelas mulai lengang.")
    if seat == "firdaus":
        narrate("Adrian mendengar percakapan lirih dua siswi — salah satunya Balqis.")
        say("Balqis", "Kasihan sih dia… tapi kalau gak ada yang bantu, ya gini terus.")
        opsi = ["Tanya Firdaus", "Tidak Bertanya"]
        pilih = choice_prompt(opsi)
        if pilih == 1:
            say("Adrian", "Dan, tadi Balqis ngomongin apa sih?")
            say("Firdaus", "Itu tentang bullying di kelas ini. Korbannya anak pendiam. Geng Alex pelakunya.")
            state["informasi_clue"] += 1
        else:
            narrate("Adrian mengangkat bahu dan berjalan ke kantin sendirian.")
    elif seat == "alex":
        narrate("Alex menepuk bahu Adrian.")
        say("Alex", "Yo, ikut gue kenalan sama geng gue.")
        opsi = ["Ikut iseng", "Menjauh"]
        pilih = choice_prompt(opsi)
        if pilih == 1:
            narrate("Adrian tertawa dan ikut obrolan rencana prank.")
            state["pengaruh_negatif"] += 2
        else:
            narrate("Adrian pura-pura lapar dan menjauh ke kantin.")
    else:
        narrate("Adrian menghabiskan waktu istirahat di kantin sendirian, menatap keramaian.")
# ==============================
# ====== MIDDLE 1 (SCENE 6-8) ===
# ==============================
def middle1(seat: str) -> bool:
    if seat == "firdaus":
        return firdaus_path()
    elif seat == "alex":
        return alex_path()
    else:
        return neutral_path()
# -----------------------
# KUNJUNGAN KE DAFIR — AKHIR HARI 1
# -----------------------
def meet_dafir_and_end_day():
    slow_print_center("=== MALAM — RUMAH DAFIR ===", wait=True)
    show_ascii("rumah dafir")       
    time.sleep(1)
    narrate("Dafir membuka pintu pelan. Wajahnya pucat, tapi ia mengizinkan kalian masuk.")
    say("Dafir", "Mereka sering ambil uangku... dan ngancem kalau aku lapor.")
    say("Firdaus", "Kami di sini buat bantu. Apa yang bisa kita lakukan?")
    say("Dafir", "Ada banyak bukti di hp Alex. Tapi aku takut.")
    narrate("Adrian dan Firdaus bingung bagaimana cara mengambil hp Alex tanpa ketahuan.")
    say("Firdaus", "Kita harus pikirin cara ambil hp itu. Kita bisa pakai cara lain.")
    say("Dafir", "Makasih ya, kalian baik banget.")
    say("Adrian", "No Problem.")
  
    state["clue"] += 2
    state["moral"] += 1
    state["hari_berganti"] = True
  
    narrate("Hari berganti. Kalian pulang dengan tekad baru.")
# -----------------------
# JALUR FIRDAUS — INVESTIGASI LORONG
# -----------------------
def firdaus_path() -> bool:
    narrate("Waktu pulang sekolah tiba. Adrian dan Firdaus berdiri di lorong kelas yang mulai sepi.")
    narrate("Cahaya sore menyusup melalui jendela. Debu melayang, papan tulis penuh kapur.")
    say("Firdaus", "Oke, Ad. Kita harus gerak. Korbannya Dafir, sekelas kita. Aku punya ide investigasi kecil-kecilan.")
    say("Adrian", "Bentar, aku pikir dulu.")
    # Daftar opsi
    options_data = [
        ("Serius — Fokus Investigasi (temui Dafir & cari bukti)", "serius"),
        ("Bercanda — Bagi tugas & bangun relasi", "bercanda"),
        ("Santai — Mengamati dari jauh", "santai"),
        ("Menghindar — Tolak terlibat", "menghindar"),
        ("Tanya balik tentang Dafir", "tanya")
    ]
    explored = set()
    will_visit_dafir = False # Tandai kalau pilih "serius"
    while len(explored) < len(options_data):
        narrate("Pilih tindakan investigasi (bisa satu per satu):")
        options = [f"{opt[0]} {'[SUDAH]' if opt[1] in explored else ''}" for opt in options_data]
        options.append("Selesai & lanjut hari")
        choice = choice_prompt(options)
        if choice == len(options):
            break
        idx = choice - 1
        key = options_data[idx][1]
        if key in explored:
            narrate("Kamu sudah melakukan tindakan ini sebelumnya.")
            continue
        explored.add(key)
        # === EKSEKUSI PILIHAN ===
        if key == "serius":
            say("Adrian", "Oke, aku ikut. Tapi kita harus hati-hati. Kita temui korban dulu.")
            say("Firdaus", "Syukurlah lo mau. Tujuan pertama: rumah Dafir nanti setelah sekolah.")
            state["investigasi"] += 2
            state["informasi_clue"] += 1
            will_visit_dafir = True
        elif key == "bercanda":
            say("Adrian", "Wih, jadi kayak detektif ya? Siap, Kapten! Hahaha.")
            say("Firdaus", "Oke, kita bagi tugas: gue urus Dafir, lo cari siapa back-up Alex.")
            state["persahabatan_firdaus"] += 1
            state["investigasi"] += 1
        elif key == "santai":
            say("Adrian", "Aku cuma mengamati dari jauh. Lo duluan aja, Dan.")
            say("Firdaus", "Oke. Tapi janji kalau ada yang aneh, chat aku.")
        elif key == "menghindar":
            say("Adrian", "Aku nggak bisa. Aku mau fokus sekolah saja.")
            say("Firdaus", "Oke, gue ngerti.")
            state["moral"] -= 1
        elif key == "tanya":
            say("Adrian", "Bentar. Dafir itu gimana sih?")
            say("Firdaus", "Dia pendiam, jago Matematika, sensitif. Mudah jadi target bullying.")
            state["informasi_clue"] += 1
        narrate(f"[Tindakan '{key}' selesai]")
    # === AKHIR HARI ===
    if will_visit_dafir:
        narrate("Malam tiba. Kalian menuju rumah Dafir...")
        meet_dafir_and_end_day()
    else:
        narrate("Kalian memutuskan untuk tidak bertemu Dafir hari ini.")
        if not state["hari_berganti"]:
            narrate("Namun, kalian tetap mencari petunjuk di sekolah...")
            investigate_loop()
    return True
# -----------------------
# LOOP INVESTIGASI LOKASI — SATU PER SATU
# -----------------------
def investigate_loop():
    locations = [
        ("lorong", "Lorong Kelas"),
        ("perpustakaan", "Perpustakaan"),
        ("kelas_lain", "Kelas lain"),
        ("gudang", "Gudang Olahraga")
    ]
    visited = set()
    while True:
        narrate("Pilih lokasi untuk mencari petunjuk:")
        options = [f"{name} {'[SUDAH]' if key in visited else ''}" for key, name in locations]
        options.append("Selesai investigasi hari ini")
        choice = choice_prompt(options)
        if choice == len(options):
            break
        loc_key = locations[choice - 1][0]
        if loc_key in visited:
            narrate("Kamu sudah mengecek tempat ini.")
            continue
        visited.add(loc_key)
        if loc_key == "lorong":
            show_ascii("lorong")       
            time.sleep(1)
            narrate("Di lorong sepi, kamu melihat coretan: 'Awas Alex + Michael'.")
            state["clue"] += 1
        elif loc_key == "perpustakaan":
            say("Kilau", "Aku lihat Alex sering bawa Dafir ke gudang belakang.")
            state["clue"] += 1
        elif loc_key == "kelas_lain":
            say("Balqis", "Dengar-dengar ada yang simpan bukti di loker tua...")
            state["clue"] += 1
        elif loc_key == "gudang":
            narrate("Di gudang, kamu menemukan kertas robek: 'Jangan lapor atau...'")
            state["clue"] += 2
            state["moral"] += 1
        narrate(f"[Clue +{1 if loc_key != 'gudang' else 2}]")
# -----------------------
# JALUR ALEX
# -----------------------
def alex_path() -> bool:
    narrate("Adrian dan Alex menuju kantin bersama geng Alex.")
    show_ascii("kantin")       
    time.sleep(1)
    narrate("Kantin berisik, aroma gorengan kuat. Geng Alex berjalan gagah menerobos antrean.")
    say("Alex", "Ayo! Jangan kayak bocil. Kita ke Mak Nyak — privilege, Bro.")
    options = [
        "Ikut bercanda & seru-seruan (bergabung sementara)",
        "Menegur Alex secara pelan",
        "Diam & observasi (jaga jarak)"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        narrate("Adrian tertawa keras, pura-pura menyenggol Alex:")
        say("Adrian", "Gila, Alex!")
        narrate("Pratama tersenyum nakal. Geng menerima Adrian lebih hangat.")
        state["pengaruh_negatif"] += 2
    elif choice == 2:
        say("Adrian", "Pelan-pelan, Lex. Gak enak dilihat banyak orang.")
        say("Alex", "Kalau takut, antri aja.")
        narrate("Namun sedikit respect muncul.")
        state["moral"] += 1
    else:
        narrate("Adrian memutuskan diam dan mengamati. Alex masih mengawasi dengan mata tajam.")
        state["observasi"] += 1
    narrate("Kalian kembali ke bangku. Balqis & Kilau menghampiri.")
    say("Balqis", "Hai, Alex. Boleh gabung? Siapa itu cowok? Murid baru ya?")
    say("Alex", "Ini Adrian, calon anggota baru kita.")
    options = [
        "Ajak mereka gabung (awal membangun relasi geng)",
        "Bercanda (kaku/sarkastik)",
        "Tetap cuek"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        say("Adrian", "Iya, duduk aja. Mau ikut seru-seruan?")
        narrate("Balqis senyum lebar. Kilau mengangguk ragu tapi tertarik.")
        state["pengaruh_negatif"] += 1
    elif choice == 2:
        narrate("Adrian bercanda canggung. Mereka tertawa canggung.")
        say("Balqis", "Prank tadi kurang gereget. Harus libatin Balqis!")
        state["pengaruh_negatif"] += 1
        state["clue"] += 1
    else:
        narrate("Adrian hanya mengangguk. Balqis pergi dengan sedikit kecewa.")
    narrate("Beberapa menit kemudian, Kilau kembali dan mengajak bicara serius.")
    say("Kilau", "Adrian, boleh ngobrol sebentar? Aku cuma mau saran, jangan salah langkah.")
    options = [
        "Dengarkan & berteman (ambil saran)",
        "Sapa singkat tapi tolak pertemanan"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        say("Adrian", "Oke Kilau, kasih saran apa?")
        say("Kilau", "Jangan terlalu dekat sama Alex. Dia berbahaya.")
        say("Adrian", "Makasih infonya, gue hargai.")
        state["persahabatan_firdaus"] += 1
    else:
        say("Adrian", "Makasih infonya, tapi gue fokus ke sekolah.")
        narrate("Kilau mengangguk dan pergi.")
        state["pengaruh_negatif"] += 1
    return True
# -----------------------
# JALUR NETRAL — INVESTIGASI MANDIRI
# -----------------------
def neutral_path() -> bool:
    show_ascii("kantin")       
    time.sleep(1)
    narrate("Kantin penuh sesak. Suara tawa dan obrolan memenuhi udara.")
    narrate("Adrian duduk sendiri, teringat pesan Arnov. Ia memutuskan untuk mengamati dan mungkin mencari petunjuk sendiri.")
    options = [
        "Observasi sendiri (teliti lingkungan)",
        "Tetap acuh & makan",
        "Tanya Bu Madrinah (guru piket) tentang situasi"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        narrate("Adrian memperhatikan siapa yang paling berkuasa dan siapa yang terlihat tertindas.")
        narrate("Ia melihat Alex & geng di kejauhan tertawa keras.")
        state["observasi"] += 1
        state["clue"] += 1
    elif choice == 2:
        narrate("Adrian memutuskan fokus makan saja. Tidak ada informasi baru.")
    else:
        say("Adrian", "Bu Madrinah, gimana situasi sekolah?")
        say("Bu Madrinah", "Tenang, Adrian. Hanya beberapa perselisihan yang sedang diatasi. Jangan khawatir.")
        state["informasi_clue"] += 1
    narrate("Kamu ingin lanjut mencari informasi? Pilih lokasi investigasi:")
    investigate_loop()
    return True
# ==============================
# ====== MIDDLE 2 — LOKER, KONFRONTASI, & SILUET ===
# ==============================
def middle2(seat: str) -> bool:
    if seat == "firdaus":
        return firdaus_middle2()
    elif seat == "alex":
        return alex_middle2()
    else:
        return neutral_middle2()
# -----------------------
# JALUR FIRDAUS — LOKER MISTERI + KONFRONTASI
# -----------------------
def firdaus_middle2() -> bool:
    slow_print_center("=== HARI KEDUA ===", wait=True)
    narrate("Firdaus menanyakan Adrian pada pagi itu untuk melanjutkan investigasi.")
    say("Firdaus", "Adrian, aku dapat info dari Dianira tentang loker misteri. Katanya ada catatan penting di sana.")
    say("Adrian", "Loker misteri? Dimana tuh?")
    say("Firdaus", "Di lorong belakang, loker tanpa nama. Kita harus cek itu.")
    narrate("Waktu pulang sekolah tiba.")
    show_ascii("lorong")       
    time.sleep(1)
    narrate("Adrian dan Firdaus bertemu di lorong setelah pelajaran terakhir.")
    narrate("Adrian dan Firdaus berjalan lorong kelas yang mulai sepi.")
    narrate("Aroma sisa makanan bercampur bau kapur kering. Perutmu mual — campuran antara rasa penasaran dan kecemasan.")
    say("Firdaus", "Adrian… Dianira bilang catatannya ada di salah satu loker tanpa nama. Tiga kemungkinan. Kita harus pilih yang tepat. Lo ikut?")
    show_ascii("LOKER")       
    time.sleep(1)
    options = [
        "Serius",
        "Bercanda",
        "Investigatif",
        "Menghindar",
        "Cemas / Ragu"
    ]
    choice = choice_prompt(options)
    monolog = ""
    if choice == 1:
        say("Adrian", "Aku ikut. Kita teliti. Salah ambil loker bisa bikin masalah besar.")
        monolog = "“Pesan Arnov nggak bisa diabaikan. Aku harus mengambil risiko ini.”"
        state["moral"] += 2
        state["persahabatan_firdaus"] += 1
    elif choice == 2:
        say("Adrian", "Hahaha, loker misteri… siapa yang bikin ini, Dianira atau ninja ya?")
        monolog = "“Tarik napas. Harus tetap chill. Tegang nggak akan menyelesaikan masalah.”"
        state["persahabatan_firdaus"] += 2
    elif choice == 3:
        say("Adrian", "Tunggu. Kita cek detail loker. Mungkin ada petunjuk tersembunyi.")
        monolog = "“Aku harus manfaatkan kesempatan ini untuk observasi.”"
        state["moral"] += 1
        state["clue"] += 1
    elif choice == 4:
        say("Adrian", "Aku… kayaknya nggak bisa ikut. Kalau ketahuan, aku bisa di-skors.")
        monolog = "“Nggak ada urusan sama aku. Aman itu penting.”"
        state["moral"] -= 1
        state["cuek"] += 1
        narrate("Firdaus kecewa. Ia pergi sendiri. Hari berlalu tanpa temuan.")
        return True
    else:
        say("Adrian", "Eh… kalo salah loker gimana? Suara kakiku keras banget di lorong sepi ini.")
        monolog = "“Ini terlalu berisiko. Aku takut Alex memergoki.”"
        state["moral"] -= 1
        state["persahabatan_firdaus"] += 1
    narrate(f"[Monolog Adrian]: {monolog}")
    if choice in [1, 2, 3, 5]:
        narrate("Kalian menuju lorong loker. Lantai berderit pelan. Tiga loker tanpa nama berdiri tegak.")
        if not locker_interaction():
            narrate("Kalian gagal membuka loker. Dianira kecewa. Hari berakhir.")
            return True
    if state.get("dianira_notes", False):
        narrate("Kalian bergegas ke perpustakaan dengan catatan Dianira. Tapi di lorong dekat lapangan...")
        narrate("Suara tawa nakal terdengar. Alex dan gengnya muncul dari tikungan.")
        say("Alex", "Eh… kalian bawa apa nih? Kertas kusut? Jangan bilang mau jadi detektif kecil ya?")
        options = [
            "Serius (Tegas)",
            "Bercanda (Mengalihkan)",
            "Chill / Cuek",
            "Pura-pura Takut",
            "Menghindar Cepat"
        ]
        choice = choice_prompt(options)
        if choice == 1:
            say("Adrian", "Kami cuma memeriksa catatan sekolah. Nggak ada urusan sama lo.")
            say("Alex", "Oh ya? Lo kayaknya cari masalah.")
            say("Adrian", "Kalau gitu, coba tangkap aku dulu.")
            narrate("Adrian kabur bersama Firdaus, meninggalkan Alex yang marah besar.")
            state["moral"] += 2
            state["persahabatan_firdaus"] += 1
            state["alex_skeptis"] = True
        elif choice == 2:
            say("Adrian", "Hahaha, santai aja, Alex… ini draft tugasku yang ketinggalan!")
            say("Alex", "Cih. Nggak lucu. Cepat pergi.")
            narrate("Firdaus menarik Adrian, mereka melangkah cepat menjauh.")
            state["persahabatan_firdaus"] += 1
        elif choice == 3:
            narrate("Adrian hanya diam, melirik Alex, lalu lanjut jalan.")
            say("Alex", "Lihat tuh, takut! Dasar pengecut, Adrian!")
            narrate("Adrian melanjutkan langkahnya tanpa menoleh.")
            state["moral"] -= 1
        elif choice == 4:
            say("Adrian", "Eh… iya, iya… santai deh. Kami cuma mau ke toilet.")
            say("Alex", "Bagus. Jangan ganggu urusan gue.")
            narrate("Adrian dan Firdaus buru-buru menjauh.")
            state["moral"] -= 2
            state["alex_menganggap_lemah"] = True
        else:
            show_ascii("lorong")       
            time.sleep(1)
            narrate("Adrian menarik Firdaus, lewat sisi lain lorong tanpa bicara.")
            say("Alex", "Hahaha! Kabur kayak tikus!")
            narrate("Mereka berdua melangkah cepat menjauh, meninggalkan Alex yang tertawa mengejek.")
            state["moral"] -= 1
    narrate("Kalian tiba di perpustakaan. Dianira menunggu dengan cemas.")
    return True
# ==============================
# LOKER INTERACTION + PUZZLE (DENGAN DIALOG BALDI INTERAKTIF)
# ==============================
def locker_interaction() -> bool:
    opened = {"danendra": False, "dianira": False, "baldi": False}
    loker_names = ["danendra", "dianira", "baldi"]
    while True:
        narrate("Pilih loker untuk dibuka:")
        options = [
            f"Loker Kiri (pola angka) — Danendra? {'[DIBUKA]' if opened['danendra'] else ''}",
            f"Loker Tengah (kumpulan huruf aneh) — Dianira? {'[DIBUKA]' if opened['dianira'] else ''}",
            f"Loker Kanan (111) — Baldi? {'[DIBUKA]' if opened['baldi'] else ''}",
            "Selesai (pulang)"
        ]
        choice = choice_prompt(options)
        if choice == 4:
            narrate("Kalian memutuskan pulang.")
            break
        idx = choice - 1
        key = loker_names[idx]
        if opened[key]:
            narrate("Loker ini sudah dibuka sebelumnya.")
            continue
        # === PROSES PUZZLE ===
        success = False
        if key == "danendra":
            success = puzzle_danendra()
        elif key == "dianira":
            success = puzzle_dianira()
        elif key == "baldi":
            success = puzzle_baldi()
        if success:
            opened[key] = True
            if key == "danendra":
                narrate("Loker terbuka! USB 'TRISTAN_CLIP' + nama: Tristan, Rusydan, Dafir.")
                state["usb"] = True
                state["clue"] += 2
                narrate("Adrian merasa lebih percaya diri, karena berhasil membuka kode matematika.")
                state["moral"] += 1
            elif key == "dianira":
                narrate("Loker terbuka! Buku catatan kronologi ditemukan!")
                show_dianira_notes()
                state["dianira_notes"] = True
                state["clue"] += 3
                say("Adrian", "... Ini penting. Kita harus bawa ini ke Firdaus.")
            elif key == "baldi":
                narrate("Loker terbuka! Baldi muncul sambil tertawa.")
                say("Baldi", "Kamu tau ga bedanya kura-kura sama undur-undur?")
                narrate("[ Pilih jawaban Adrian ]")
                jawaban = [
                    "Apa?",
                    "Gak tau, ceritain dong!",
                    "Langsung jawab aja, Baldi!"
                ]
                pilih = choice_prompt(jawaban)
                if pilih == 1:
                    say("Adrian", "Apa?")
                    say("Baldi", "Gak ada bedanya! Sama-sama diulang!")
                    narrate("Baldi tertawa ngakak sambil menepuk lutut.")
                elif pilih == 2:
                    say("Adrian", "Gak tau, ceritain dong!")
                    say("Baldi", "Ya Tuhan... oke, gak ada bedanya! Sama-sama diulang!")
                    narrate("Baldi pura-pura kesal, tapi tetap ketawa.")
                else:
                    say("Adrian", "Langsung jawab aja, Baldi!")
                    say("Baldi", "Hah? Yaelah, gak ada bedanya! Sama-sama diulang!")
                    narrate("Baldi ngeloyor pergi sambil geleng-geleng kepala.")
                say("Baldi", "Aku ambil manga Madoka Magicaku ya, makasih udah buka loker! Hahaha!")
                state["moral"] += 1
        else:
            narrate("Gagal membuka loker.")
    return any(opened.values())
# ==============================
# PUZZLE LOKER (TANPA PERUBAHAN LOGIKA)
# ==============================
def puzzle_danendra() -> bool:
    narrate("Loker Kiri: Pola angka: 1, 2, 4, 7, 11, ?")
    for _ in range(3):
        ans = input("Masukkan angka: ").strip()
        if ans == "16":
            narrate("KLEK! Loker terbuka!")
            return True
        narrate("Salah. Hint: selisih +1, +2, +3, +4, +5")
    narrate("Gagal. Loker terkunci.")
    return False
def puzzle_dianira() -> bool:
    narrate("Loker Tengah: Susun huruf: A K R U P M A → ?")
    for _ in range(3):
        ans = input("Masukkan kata: ").strip().upper()
        if ans == "PRAMUKA":
            narrate("KLEK! Loker terbuka!")
            return True
        narrate("Salah. Hint: Ekstrakurikuler wajib yang melatih kemandirian dan disiplin.")
    narrate("Gagal. Loker terkunci.")
    return False
def puzzle_baldi() -> bool:
    narrate("Loker Kanan: Stiker '111' terpasang. Masukkan kode:")
    ans = input("Masukkan kode: ").strip()
    if ans == "111":
        narrate("Loker terbuka! Baldi muncul sambil tertawa.")
        return True
    narrate("Salah. Baldi masih ngobrol.")
    return False
def show_dianira_notes():
    slow_print_center("=== CATATAN DIANIRA (KRONOLOGI Dafir) ===")
    notes = [
        "- 15/03: Dafir dilaporkan ke Pak Budi karena 'kecurangan ujian'",
        "- Alex & Michael: sering ambil uang Dafir di kantin",
        "- Lokasi: Pojok rak Kimia, Gudang Olahraga, Atap",
        "- Motif: Dafir tahu Alex curang di olimpiade",
        "- Saksi: Rusydan, Khenza, Balqis (takut bicara)"
    ]
    for note in notes:
        narrate(note)
# -----------------------
# JALUR ALEX — KERIBUTAN & PENGARUH
# -----------------------
def alex_middle2() -> bool:
    slow_print_center("=== HARI KEDUA ===", wait=True)
    narrate("Alex mengajak Adrian ke kantin bersama gengnya.")
    show_ascii("kantin")       
    time.sleep(1)
    narrate("Kantin riuh. Aroma minyak kuat. Alex dan gengnya menerobos antrian.")
    say("Alex", "Mak, yang biasa! Cepet, Boss lapar! Nyerobot antrian itu privilege, Bro.")
    options = [
        "Ikut Santai / Bercanda",
        "Menegur (Pelan)",
        "Observasi / Diam",
        "Tolak Tegas",
        "Memalak (Menggertak)"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        say("Adrian", "Haha, boleh juga… kayak game aja ya?")
        say("Alex", "Anak ini punya nyali. Bagus.")
        state["pengaruh_negatif"] += 2
    elif choice == 2:
        say("Adrian", "Pelan-pelan, Lex. Nggak enak dilihatin.")
        say("Alex", "Cih. Sok bersih.")
        state["moral"] += 1
    elif choice == 3:
        narrate("Adrian diam, mengamati siswa yang menunduk ketakutan.")
        state["observasi"] += 1
    elif choice == 4:
        say("Adrian", "Tidak. Aku nggak mau ikut perundungan.")
        say("Alex", "Lo cari masalah sama gue.")
        state["moral"] += 2
        state["alex_marah_besar"] = True
    else:
        say("Adrian", "Eh, lo! Antri di belakang sana!")
        say("Alex", "Gila. Dia lebih nakal dari gue.")
        state["pengaruh_negatif"] += 3
        state["moral"] -= 2
    # Balqis & Kilau
    narrate("Balqis menghampiri Adrian. Kilau mengamati dari jauh.")
    say("Balqis", "Hai, Alex. Boleh gabung? Siapa cowok itu?")
    options = ["Serius", "Bercanda"]
    choice = choice_prompt(options)
    if choice == 1:
        say("Adrian", "Iya, Aku Adrian. Mau ikut seru-seruan?")
        narrate("Alex mengangguk. Balqis tersenyum lebar.")
        say("Balqis", "Aku tahu prank kalian kurang gereget. Libatin Balqis!")
        say("Alex", "Santai, kita lihat dulu.")
        say("Adrian", "Ayo dong!")
        state["pengaruh_negatif"] += 1
    else:
        say("Adrian", "Hahaha, kenapa lo berdua? Baru lihat cowok ganteng ya?")
        state["pengaruh_negatif"] += 1
    say("Kilau", "Adrian, jangan salah langkah. Alex punya sejarah.")
    options = ["Dengarkan Saran", "Tolak"]
    choice = choice_prompt(options)
    if choice == 1:
        say("Kilau", "Dulu Alex anak pintar, tapi tekanan orang tua bikin dia berubah.")
        state["insight_sosial"] = True
    return True
# -----------------------
# JALUR NETRAL — SILUET & OBSERVASI
# -----------------------
def neutral_middle2() -> bool:
    slow_print_center("=== HARI KEDUA ===", wait=True)
    show_ascii("kantin")       
    time.sleep(1)
    narrate("Adrian berada di kantin yang ramai. Ia memutuskan untuk mengamati situasi sekitar dengan seksama.")
    narrate("Adrian duduk sendirian. Mengamati handphonenya.")
    narrate("[Monolog]: 'Kalau aku ikut campur… apa mereka bakal marah? Tapi kalau tidak, aku bisa menyesal.'")
    options = [
        "Adrian keliling sekolah untuk cari petunjuk",
        "Acuh (Tetap Duduk)",
        "Tanya Pak Firman (Guru BK)"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        state["observasi"] += 1
        library_neutral_interaction()
    elif choice == 3:
        say("Adrian", "Pak Firman, gimana situasi di sekolah akhir-akhir ini?")
        say("Pak Firman", "SMA Negeri 01 Batu aman. Hanya sedikit perselisihan yang sedang diatasi.")
        narrate("Adrian tidak mencatat informasi tidak penting ini.")
        state["informasi_clue"] += 1
    if state.get("observasi", 0) > 0:
        narrate("Adrian mengikuti mendapat informasi bahwa Alex sering ke Gudang Olahraga. Maka ia segera pergi ke sana.")
        show_ascii("GEDUNG_OLAHRAGA")       
        time.sleep(1)
        narrate("Siluet Alex dan Michael terlihat. Mereka membuang sesuatu ke semak.")
        options = ["Mengintip Diam-diam", "Mendekat & Tanya", "Pura-pura Pergi"]
        choice = choice_prompt(options)
        if choice == 1:
            narrate("[Monolog]: 'Aku cuma bisa lihat bayangan… tapi mereka membuang sesuatu.'")
            state["clue"] += 1
            narrate("Saat pergi, Adrian mendengar Alex bilang: '...loker lama itu harus dicek.'")
            state["loker_hint"] = True # ← DAPAT PETUNJUK LOKER
        elif choice == 2:
            narrate("Alex menoleh tajam.")
            say("Alex", "Apa urusan lo?")
            say("Adrian", "Maaf, aku cuma penasaran. Apa yang kalian buang?")
            say("Michael", "Nggak ada urusan lo, bro. Mending pergi aja.")
            narrate("Adrian pergi dengan perasaan was-was.")
            state["moral"] += 1
            state["clue"] += 1
            narrate("Saat pergi, Adrian mendengar Alex bilang: '...loker lama itu harus dicek.'")
            state["loker_hint"] = True # ← DAPAT PETUNJUK LOKER
        # choice 3: netral → tidak dapat petunjuk loker
    # === LOKER HANYA MUNCUL JIKA DAPAT PETUNJUK ===
    if state.get("loker_hint", False):
        narrate("[Monolog]: 'Loker lama… aku harus cek sekarang.'")
        neutral_locker_interaction() # ← PUZZLE MUNCUL DI SINI!
        state["clue"] += 2 # Bonus clue dari loker
    narrate("[ Kamu semakin dekat kepada kebenaran... ]")
    return True
def library_neutral_interaction():
    narrate("Adrian menuju perpustakaan untuk mencari petunjuk.")
    show_ascii("PERPUSTAKAAN")       
    time.sleep(1)
    narrate("Adrian memasuki perpustakaan yang tenang.")
    narrate("Beberapa siswa tampak asyik membaca atau mengerjakan tugas.")
    narrate("Ia melihat beberapa teman sekelasnya di sana.")
    while True:
        narrate("Di perpustakaan, pilih siapa yang akan ditanyai:")
        options = ["Dianira", "Kilau", "Rusydan", "Selesai"]
        choice = choice_prompt(options)
        if choice == 4:
            break
        if choice == 1:
            narrate("Dianira gelisah, dia kabur setelah meneriakan 'Jangan ganggu aku!'")
            narrate("Adrian merasa ada sesuatu yang disembunyikan Dianira.")
            state["clue"] += 1
        elif choice == 2:
            say("Adrian", "Hai Kilau, kamu tahu sesuatu tentang Alex?")
            say("Kilau", "Geng Alex sering kumpul di Gudang Olahraga.")
            narrate("Adrian mencatat informasi penting ini.")
            state["clue"] += 1
        elif choice == 3:
            say("Adrian", "Hey, kamu kenal Dafir?")
            say("Rusydan", "Kenal, kalau kamu kepo, aku saranin jangan deh.")
            say("Adrian", "Oke.")
            state["digital_clue"] += 1
# ==============================
# ====== MIDDLE 3 — KONFRONTASI & PILIHAN MORAL TERAKHIR ===
# ==============================
def middle3(seat: str) -> bool:
    if seat == "firdaus":
        return firdaus_middle3()
    elif seat == "alex":
        return alex_middle3()
    else:
        return neutral_middle3()
# ==============================
# JALUR FIRDAUS — MIDDLE 3 (ANALISIS + INVESTIGASI + PUZZLE + RENCANA)
# ==============================
def firdaus_middle3() -> bool:
    # === INISIALISASI STATE ===
    clue = state.get("clue", 0)
    moral = state.get("moral", 0)
    # ==============================
    # 1. ANALISIS CATATAN DIANIRA (PERPUSTAKAAN)
    # ==============================
    show_ascii("perpus")   
    time.sleep(1)
    narrate("Adrian dan Firdaus duduk di pojok perpustakaan, membuka catatan Dianira.")
    say("Firdaus", "Wah, ini kronologi lengkapnya. Kita harus pikirin langkah selanjutnya.")
    say("Adrian", "Iya, ini bisa jadi bukti kuat.")
    say("Dianira", "Aku nggak mau terlibat lebih jauh, tapi aku harap ini bisa bantu kalian.")
    say("Dianira", "Tristan itu anak baik, tapi dia sering jadi sasaran karena tahu terlalu banyak tentang Alex.")
    say("Dianira", "Aku tahu tentang Tristan dulu. Aku ikut sedikit, makanya aku simpan catatan ini.")
    narrate("[Internal Monolog Adrian]: 'Dia membenarkan tindakannya? Firdaus ragu. Moralku cukup kuat?'")
    options = [
        "Percaya Dianira",
        "Tidak Percaya",
        "Bertanya Detail",
        "Skeptis & Interogatif",
        "Menenangkan"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        say("Adrian", "Oke, aku percaya perspektifmu. Catatan ini berharga.")
        narrate("Dianira lega. (+2 Clue, -1 Moral)")
        clue += 2
        moral -= 1
        state["percaya_dianira"] = True
    elif choice == 2:
        say("Adrian", "Bullying tetap salah, terlepas dari sifat korban.")
        narrate("Firdaus mengangguk. (+2 Moral, +1 Relasi Firdaus)")
        moral += 2
        state["persahabatan_firdaus"] += 1
        state["percaya_dianira"] = False
    elif choice == 3:
        say("Adrian", "Siapa pelaku utama? Alasan Tristan jadi target?")
        say("Dianira", "Alex & Pratama. Tristan lihat Alex curang ujian.")
        clue += 1
        state["percaya_dianira"] = True
    elif choice == 4:
        say("Adrian", "Catatan ini setengah benar buat ringankan kesalahanmu?")
        say("Dianira", "Aku nggak bohong!")
        clue += 1
        state["percaya_dianira"] = False
    else:
        say("Adrian", "Santai dulu. Kita fokus fakta.")
        say("Firdaus", "Ya, kita harus fokus.")
        moral += 1
        state["persahabatan_firdaus"] += 1
        state["percaya_dianira"] = True
    # ==============================
    # 2. [JIKA PERCAYA] → PUZZLE HP ALEX (VERSI Alex)
    # ==============================
    if state.get("percaya_dianira", False):
        slow_print_center("=== KEMBALI KE KELAS ===")
        narrate("Adrian dan Firdaus kembali ke kelas, bahas hasil retest MTK.")
        narrate("Tiba-tiba, DIANIRA berlari masuk — tangannya memegang HP ALEX!")
        say("Dianira", "Aku pinjam HP-nya buat minta catatan ujian! Tapi dia curiga! Dia balik dalam 30 detik!")
        say("Adrian", "Cepat! Kita harus buka HP-nya!")
        if puzzle_hp_alex():
            narrate("KREK! LAYAR TERBUKA!")
            narrate("Chat Alex-Michael: rencana bullying, kunci jawaban curian, manipulasi.")
            state["bukti_digital"] = True
            clue += 6
        else:
            narrate("Alex masuk! 'LO BERANI SENTUH HP GUE?!'")
            narrate("Dianira gemetar. HP direbut.")
            moral -= 3
    else:
        narrate("Dianira tidak muncul. Kalian hanya mengandalkan catatan.")
    # ==============================
    # 3. PUZZLE KRONOLOGI (MALAM HARI)
    # ==============================
    slow_print_center("=== MALAM PENYUSUNAN BUKTI ===")
    narrate("Adrian dan Firdaus duduk di kamar. Semua bukti di atas meja.")
    if puzzle_kronologi_bukti():
        narrate("KRONOLOGI SELESAI! Semua terhubung sempurna.")
        state["kronologi_kuat"] = True
        clue += 3
    else:
        narrate("Kronologi masih lemah. Ada yang kurang.")
        state["kronologi_kuat"] = False
    # ==============================
    # 4. RENCANA KONFRONTASI
    # ==============================
    narrate("Dianira mengirim pesan: 'Alex benci rencana gagal. Pilih strategi.'")
    options = [
        "Laporkan ke BK",
        "Mengancam Balik",
        "Membujuk",
        "Chill"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        say("Adrian", "Langsung ke Guru BK. Cara paling aman.")
        narrate("Kalian sepakat: besok pagi lapor.")
        moral += 2
        state["rencana_bk"] = True
    elif choice == 2:
        say("Adrian", "Blackmail dia pakai bukti.")
        narrate("Pesan anonim dikirim. Moral turun.")
        moral -= 2
        state["rencana_blackmail"] = True
    elif choice == 3:
        say("Adrian", "Kita ajak Alex bicara baik-baik.")
        narrate("Firdaus setuju. Mungkin ada jalan damai.")
        state["persahabatan_firdaus"] += 1
        state["rencana_bicara"] = True
    else:
        say("Adrian", "Simpan bukti sebagai kartu As.")
        narrate("Kalian tunggu momen tepat.")
        state["observasi"] += 1
        state["rencana_chill"] = True
    # ==============================
    # 5. AKHIR MIDDLE 3 — TIDAK KE BK!
    # ==============================
    narrate("Malam berakhir. Bukti sudah lengkap.")
    say("Firdaus", "Besok... kita selesaikan ini.")
    narrate("Adrian mengangguk. 'Iya. Bersama.'")
    # Update state
    state["clue"] = clue
    state["moral"] = moral
    return True
# ==============================
# PUZZLE: KRONOLOGI BUKTI (URUTKAN 5 KEJADIAN)
# ==============================
def puzzle_kronologi_bukti() -> bool:
    events = [
        "Alex gagal Olimpiade Provinsi",
        "Alex bertemu Michael",
        "Alex mulai bullying Dafir",
        "Nilai Alex anjlok drastis",
        "Alex sering ke ruang BK"
    ]
    correct_order = [0, 1, 3, 4, 2] # Urutan benar: 1→2→4→5→3
    narrate("Urutkan 5 kejadian ini (ketik nomor 1-5, dipisah spasi):")
    for i, e in enumerate(events, 1):
        narrate(f" {i}. {e}")
    for attempt in range(1, 3): # 2 kesempatan
        narrate(f"[ Percobaan {attempt}/2 ]")
        ans = input(" Urutan: ").strip().split()
      
        if len(ans) != 5:
            narrate(" Harus 5 angka! Coba lagi.")
            continue
      
        try:
            order = [int(x) - 1 for x in ans] # Konversi ke indeks
            if order == correct_order:
                narrate("KRONOLOGI TEPAT! Semua terhubung sempurna.")
                return True
            else:
                narrate(" Urutan salah. Coba lagi.")
        except ValueError:
            narrate(" Masukkan angka saja!")
    narrate("GAGAL! Kronologi masih lemah.")
    return False
# ==============================
# PUZZLE Alex: MEMBUKA HP ALEX (30 DETIK + 3X COBA) — WINDOWS SAFE!
# ==============================
def puzzle_hp_alex() -> bool:
    narrate("Layar HP Alex: 'Alex CODE ACTIVE'")
    narrate("Petunjuk: '349-21-45' → konversi ke huruf via Alex Table!")
  
    Alex_table = {"34": "O", "39": "L", "21": "Y", "45": "M", "9": "P", "1": "I", "4": "A", "5": "D"}
    narrate("TABEL: 34=O | 39=L | 21=Y | 45=M | 9=P | 1=I | 4=A | 5=D")
    narrate("Clue: 34 - 39 - 21 - 45 - 9 - 1 - 4 → O ? Y ? M ? ?→ ")
  
    correct_pin = "OLYMPIA"
    max_attempts = 3
    def input_with_timeout(prompt, timeout, q):
        """Input dengan timeout menggunakan thread"""
        print(prompt, end="", flush=True)
        try:
            ans = input()
            q.put(ans)
        except:
            q.put("")
    for attempt in range(1, max_attempts + 1):
        narrate(f"--- PERCOBAAN {attempt}/{max_attempts} ---")
        narrate("Ketik PIN 6 HURUF:")
        q = queue.Queue()
        start_time = time.time()
        input_thread = threading.Thread(target=input_with_timeout, args=("", 30, q))
        input_thread.daemon = True
        input_thread.start()
        answer = None
        while time.time() - start_time < 30:
            remaining = int(30 - (time.time() - start_time))
            print(f"\r PIN (sisa {remaining}s): ", end="", flush=True)
          
            if not q.empty():
                answer = q.get().strip().upper()
                break
            time.sleep(0.1)
        print() # Baris baru
        if answer == correct_pin:
            narrate("KREK! LAYAR TERBUKA!")
            narrate("Chat Alex-Michael: rencana bullying, foto Dafir, kunci jawaban curian.")
            state["bukti_digital"] = True
            state["clue"] += 6
            return True
        elif answer:
            narrate(f" Salah! '{answer}'")
        else:
            narrate(" WAKTU HABIS!")
        if attempt < max_attempts:
            narrate("Dianira: 'Aku tahan Alex! Coba lagi!'")
            state["moral"] -= 1
        else:
            narrate("Alex masuk! 'HP GUE MANA?!'")
            return False
    return False
  
# -----------------------
# JALUR ALEX — CEK MENTAL + UJIAN MORAL
# -----------------------
def alex_middle3() -> bool:
    narrate("Angin sore kencang. Daun bergesekan. Tekanan terasa kental.")
    narrate("Alex dan Adrian bertemu dengan Michael di lapangan belakang sekolah.")
    say("Alex", "Ini Michael. Dia cek mental lo.")
    say("Michael", "Positif, Netral, atau Lemah?")
    options = [
        "Positif",
        "Netral",
        "Negatif (Tolak Keras)"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        say("Michael", "Jadi, gimana kalo kita rundung 2 bocah itu?")
        say("Adrian", "Ayo aja")
        say("Michael", "Gila, lo berani banget!")
        state["pengaruh_negatif"] += 2
    elif choice == 2:
        say("Michael", "Gimana perasaan lo soal ini?")
        say("Adrian", "Biasa aja.")
        say("Michael", "Ga asik lu.")
    elif choice == 3:
        narrate("Adrian menolak keras.")
        say("Adrian", "Aku nggak nyaman.")
        say("Michael", "Lemah!")
        state["moral"] -= 2
    # UJIAN MORAL:
    narrate("Alex: 'Ini yang pantas dikasih pelajaran.'")
    say("Nita", "Tolong… jangan!")
    narrate("[Monolog]: 'Ini salah… tapi Alex curiga kalau aku menolak.'")
    options = [
        "Menggertak",
        "Membiarkan",
        "Menahan Diri & Peringatan Halus",
        "Bercanda Tanpa Menyakiti"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        say("Adrian", "Cepat pergi! Lain kali jangan cari masalah!")
        state["moral"] -= 2
        state["pengaruh_negatif"] += 2
    elif choice == 2:
        narrate("Adrian diam.")
        say("Alex", "Nggak usah sok suci.")
    elif choice == 3:
        say("Adrian", "Jangan lewat sini lagi.")
        say("Alex", "Lo ngomong apa?")
        state["moral"] += 2
    else:
        say("Adrian", "Sudahlah, Lex. Lapar nih.")
        narrate("Korban kabur lega.")
        state["moral"] += 1
        state["pengaruh_negatif"] += 1
    # KONFRONTASI DAKA & SPARTAN
    narrate("Daka dan Spartan mendekat dengan tatapan curiga.")
    say("Daka", "Kami denger lo ikut Alex. Jujur deh.")
    say("Spartan", "Kami dengar dari Ghifari. Lo di sana, kan?")
    options = [
        "Jujur",
        "Bohong",
        "Mengaku Sebagian",
        "Mengalihkan Topik"
    ]
    choice = choice_prompt(options)
    if choice == 1:
        narrate("Adrian menghela napas.")
        say("Adrian", "Iya, tapi nggak nyakitin siapa-siapa.")
        say("Daka", "Baiklah, kami percaya.")
        say("Spartan", "Aku sarankan kamu minta maaf ke mereka.")
        narrate("Adrian mengangguk.")
        state["moral"] += 2
    elif choice == 2:
        narrate("Adrian menjawab dengan santai.")
        say("Adrian", "Nggak, aku di toilet.")
        say("Daka", "Kami punya bukti dari Ghifari kalau kau disana! jangan bohong!")
        say("Spartan", "Iya loh, kami sebagai anggota OSIS tahu semua kejadian di sekolah ini.")
        say("Daka", "Betul betul betul")
        narrate("Adrian merasa terpojok.")
        state["moral"] -= 1
    elif choice == 3:
        narrate("Adrian mengakui sebagian.")
        say("Adrian", "Cuma nonton.")
        say("Spartan", "Menonton juga salah.")
        say("Daka", "Kamu mau berurusan dengan Ketua OSIS Gita?")
        say("Spartan", "Oooh, seramnyoo..")
    else:
        narrate("Adrian mengalihkan pembicaraan.")
        say("Adrian", "Eh, PR Matematika susah ya?")
        say("Daka", "Jangan alihkan!")
        narrate("Adrian lari dari tempat kejadian")
    return True
# ==============================
# LOKER INTERAKTIF + PUZZLE RUSYDAN & GHIFARI (SUDAH GABUNG)
# ==============================
def neutral_puzzle_rusydan() -> bool:
    narrate("[Loker 1 — Rusydan] Pola angka: 3, 6, 9, 12, ?")
    for attempt in range(1, 3):
        ans = input(f" Masukkan jawaban (percobaan {attempt}/2): ").strip()
        if ans == "15":
            narrate("KLEK! Loker terbuka!")
            return True
        narrate("Salah. Hint: kelipatan 3")
    narrate("Gagal. Loker tetap terkunci.")
    return False
def neutral_puzzle_ghifari() -> bool:
    narrate("[Loker 2 — Ghifari] Susun huruf: G H I F A R I → ?")
    for attempt in range(1, 3):
        ans = input(f" Masukkan kata (percobaan {attempt}/2): ").strip().upper()
        if ans == "GHIFARI":
            narrate("KLEK! Loker terbuka!")
            return True
        narrate("Salah. Hint: nama teman sekelas")
    narrate("Gagal. Loker tetap terkunci.")
    return False
def neutral_locker_interaction() -> bool:
    opened = {"rusydan": False, "ghifari": False, "dianira": False}
    loker_names = ["rusydan", "ghifari", "dianira"]
    while True:
        narrate("Pilih loker lama untuk dibuka:")
        options = [
            f"Loker 1 (Kode angka rumit) — Rusydan? {'[DIBUKA]' if opened['rusydan'] else ''}",
            f"Loker 2 (beberapa huruf acak) — Ghifari? {'[DIBUKA]' if opened['ghifari'] else ''}",
            f"Loker 3 (kumpulan huruf aneh) — Dianira? {'[DIBUKA]' if opened['dianira'] else ''}",
            "Selesai (lanjut)"
        ]
        choice = choice_prompt(options)
        if choice == 4:
            break
        idx = choice - 1
        key = loker_names[idx]
        if opened[key]:
            narrate("Loker ini sudah dibuka sebelumnya.")
            continue
        # === PUZZLE ===
        success = False
        if key == "rusydan":
            success = neutral_puzzle_rusydan()
        elif key == "ghifari":
            success = neutral_puzzle_ghifari()
        elif key == "dianira":
            success = puzzle_dianira()
        if success:
            opened[key] = True
            if key == "rusydan":
                narrate("Loker terbuka! Tristan, Dafir, serta Alex dan Michael terlibat ada di foto")
                state["clue"] += 1
                narrate("Adrian merasa lega bisa membuka loker ini.")
                say("Adrian", "Love letter untuk Sekar? Sepertinya lebih baik tidak menyentuhnya.")
            elif key == "ghifari":
                narrate("Loker Terbuka! [LOGBOOK KEJADIAN - BULLYING Dafir]")
                narrate("- 12/11/25 10:15 — Tas Dafir disembunyikan oleh Pratama di loker kosong")
                narrate("- Pelaku: Pratama | Lokasi: Area Loker")
                narrate("- Motif: Iseng & ingin membuat Dafir panik")
                narrate("- 12/11/25 12:00 — Khenza melakukan bully verbal di kantin")
                narrate("- Pelaku: Khenza | Lokasi: Kantin Sekolah")
                narrate("- Dampak: Dilihat banyak siswa, tidak ada yang menolong")
                narrate("- 12/11/25 14:30 — Pengucilan massal")
                narrate("- Pelaku: Pratama & Khenza | Lokasi: Lapangan")
                narrate("- Motif: Membentuk kelompok 'anti-Dafir'")
                narrate("- Saksi: Beberapa siswa")
                state["clue"] += 3
                say("Adrian", "Khenza? Sudah kubilang dia terlihat gugup tadi.")
                narrate("Adrian mendapat jawaban ulangan harian matematika dari Ghifari. Tapi dia merasa lebih baik tidak mengambilnya.")
            elif key == "dianira":
                narrate("Loker terbuka! Buku catatan kronologi ditemukan!")
                show_dianira_notes()
                say("Adrian", "... Nice find. Ini penting. Aku harus menyimpan ini.")
                state["dianira_notes"] = True
                state["clue"] += 3
        else:
            narrate("Gagal membuka loker.")
    return any(opened.values())
def neutral_middle3() -> bool:
    show_ascii("lorong")       
    time.sleep(1)
    narrate("Adrian berjalan di lorong belakang sekolah setelah ia mendapatkan makanan dari kantin.")
    narrate("Ia pun mengingat beberapa petunjuk yang ia dapatkan selama ini.")
    narrate("...")
    narrate("BRUAK!")
    narrate("...")
    narrate("Adrian tertabrak oleh 2 orang yang sedang berlari ketakutan.")
    say("Adrian", "Siapa kalian? Apa yang terjadi?")
    # === Vara & Nita ===
    narrate("Vara & Nita tampak ketakutan di lorong belakang.")
    vara_options = [
        "Bertanya Serius",
        "Curiga",
        "Bercanda"
    ]
    vara_choice = choice_prompt(vara_options)
    if vara_choice == 1:
        say("Adrian", "Apa yang terjadi? Kenapa kalian lari?")
        say("Vara", "Jangan ikut campur… nanti lo juga kena.")
        say("Adrian", "Aku cuma mau bantu.")
        narrate("Nita dan Vara semakin menjauhkan diri dari Adrian.")
        say("Adrian", "Tunggu…!")
        state["clue"] += 1
    elif vara_choice == 2:
        narrate("Adrian amati dari jauh.")
        narrate("Vara dan Nita saling berpandangan gugup.")
        say("Vara", "Kita nggak boleh cerita… mereka bisa marah")
        say("Adrian", "Siapa mereka?")
        narrate("Vara dan Nita langsung berlari menjauh.")
        narrate("Adrian mendekati jejak kaki yang tertinggal.")
        narrate("Adrian mengetahui bahwa mereka berlari dari gudang olahraga.")
        state["clue"] += 3
    else:
        say("Adrian", "Lagi takut hantu ya?")
        say("Vara", "Haha, bukan…")
        narrate("Adrian melihat ada bekas goresan di lengan Nita.")
        narrate("Vara dan Nita bergegas pergi.")
        narrate("Adrian merasa ada yang aneh.")
        state["clue"] += 1
    narrate("...")
    narrate("Adrian ingin mencari tahu lebih lanjut tentang apa yang terjadi di lorong belakang tadi.")
    narrate("Ia pun memutuskan untuk mencari beberapa orang yang mungkin bisa memberikan informasi.")
    # === TARGET INTERAKSI TERAKHIR (DITAMBAH LAB KIMIA!) ===
    show_ascii("lorong")       
    time.sleep(1)
    narrate("Adrian berjalan menyusuri lorong sekolah, mencari seseorang yang mungkin bisa memberinya petunjuk lebih lanjut.")
    narrate("Ia pun menelusuri beberapa target potensial untuk diajak bicara.")
    narrate("Pilih tempat Adrian menelusuri:")
    target_options = [
        "Taman Sekolah",
        "Kantin",
        "Gerbang Sekolah",
        "Laboratorium Kimia"
    ]
    target_choice = choice_prompt(target_options)
    if target_choice == 1:
        narrate("Firdaus sedang berdiri di dekat taman sekolah.")
        say("Adrian", "Firdaus, ada yang aneh di lorong belakang tadi?")
        say("Firdaus", "Balqis tahu banyak gosip. Jangan tanya aku.")
        state["clue"] += 1
    elif target_choice == 2:
        show_ascii("kantin")       
        time.sleep(1)
        narrate("Mak Nyak sedang membersihkan meja di kantin.")
        say("Adrian", "Permisi, Bu. Apakah Ibu tahu mengenai keributan di lorong belakang tadi?")
        say("Mak Nyak", "Alex dan teman-temannya sering mengincar anak bawa bekal mahal. Hati-hati, Nak.")
        say("Adrian", "Terima kasih, Bu.")
        state["clue"] += 3
    elif target_choice == 3:
        show_ascii("gerbang")       
        time.sleep(1)
        narrate("Pak Udin sedang berjaga di gerbang sekolah.")
        say("Pak Udin", "Tadi ada anak nangis di lorong belakang. Aku cuma bisa doain.")
        say("Adrian", "Siapa namanya, Pak?")
        say("Pak Udin", "Gatau.")
        say("Adrian", "Oke, Pak.")
        state["clue"] += 1
    elif target_choice == 4:
        show_ascii("laboratorium kimia")       
        time.sleep(1)
        narrate("Adrian masuk ke Lab Kimia.")
        narrate("Bau etanol dan sulfur tercium samar. Maul sedang membersihkan gelas ukur,")
        narrate("sementara Spartan bersandar di meja, membaca textbook dengan ekspresi datar.")
        say("Adrian", "Maul, Spartan. Boleh ganggu sebentar? Aku dengar ada kunci loker penting")
        say("Spartan", "Kunci Loker? Hmm.. Sepertinya ada di kotak P3K, apa kamu tau ul?")
        say("Maul", "Kotak P3K? Mungkin masih ada. Kamu butuh buat apa?")
        say("Adrian", "Uhh.. ")
        say("Spartan", "Bantuan kami ada harganya. Kami butuh Pelarut Kunci untuk membersihkan noda bandel.")
        say("Maul", "Kamu cuma perlu mencampur dua dari tiga botol ini.")
        say("Spartan", "Cairan Pelarut Kunci yang kita tau besar kemungkinan adalah membentuk warna campuran.")
        say("Adrian", "Oke, aku coba.")
        narrate("Di meja ada tiga botol:")
        narrate(" 1. Cairan Merah (Asam Kuat)")
        narrate(" 2. Cairan Biru (Basa Lemah)")
        narrate(" 3. Cairan Bening (Air Suling)")
        narrate("Pilih dua cairan yang akan digabung:")
        chem_options = [
            "GABUNG Cairan Merah + Cairan Biru",
            "GABUNG Cairan Merah + Cairan Bening",
            "GABUNG Cairan Biru + Cairan Bening"
        ]
        chem = choice_prompt(chem_options)
        if chem == 1:
            narrate("Adrian mencampur Cairan Merah dan Cairan Biru...")
            narrate("Gelembung halus muncul… lalu warna berubah menjadi UNGU PEKAT!")
            say("Maul", "Wah! Tepat sekali! Itu dia Pelarut Kunci!")
            say("Spartan", "Logikamu cepat. Janji adalah janji.")
            narrate("Maul menggeser kotak P3K berdebu dan mengambil sebuah kunci kecil.")
            say("Maul", "Ini kunci loker tua ada di pojok gudang olahraga. Anggap kami tidak ikut campur lagi ya.")
            say("Adrian", "Terima kasih banyak, Maul. Spartan.")
            narrate("Adrian mendapatkan → KUNCI LOKER TUA")
            state["kunci_tua"] = True
            state["relasi_maul"] += 1
            state["relasi_spartan"] += 1
            state["clue"] += 5
        else:
            result = "merah pudar" if chem == 2 else "biru pudar"
            narrate(f"Adrian mencampur… warnanya jadi {result}. Bau aneh keluar.")
            narrate("Asap tipis mengepul. Tiba-tiba… BAU BUSUK MENYENGAT!")
            narrate("Adrian terbatuk-batuk, matanya pedih.")
            narrate("DUARRR!!! Suara ledakan kecil terdengar!")
            narrate("Bahan kimia yang ada di tangan Adrian Meledak!")
            say("Maul", "Astaga!")
            say("Spartan", "Gila! Lo nggak tau apa-apa tentang kimia ya?")
            say("Maul", "Dasar karbit!")
            narrate("Adrian pulang tanpa kunci.")
            state["relasi_maul"] -= 10
            state["relasi_spartan"] -= 10
    narrate("Adrian kembali ke lorong belakang. Pikirannya tertuju pada loker tua di Gudang Olahraga.")
    show_ascii("gudang olahraga")       
    time.sleep(1)
    if state.get("kunci_tua", False):
        narrate("Adrian mengeluarkan KUNCI LOKER TUA yang didapat dari Maul & Spartan.")
        narrate("KREK! Gembok loker terbuka dengan mulus.")
        narrate("Di dalam loker terdapat bukti-bukti penting: foto, catatan, dan logbook bullying.")
        narrate("Adrian mendapatkan bukti kuat tentang Alex, Tristan, dan Dafir.")
        state["clue"] += 8
        state["lokertua_opened"] = True
        say("Adrian", "Akhirnya… semua terhubung.")
    else:
        narrate("Di lantai gudang ada tiga step aerobik bertuliskan angka:")
        narrate(" '3' — '1' — '4'")
        narrate("Di bawahnya ada catatan kusut:")
        narrate(" 'Naik → baca maju.'")
        narrate(" 'Turun → baca mundur.'")
        narrate(" 'Jika posisi awalmu di tengah, lompatkan angka tengah ke akhir.'")
        narrate("Kamu mengecek lantai dan menemukan tanda kapur di tempatmu berdiri…")
        narrate("Kamu sedang TURUN dan POSISI AWAL: TENGAH.")
        narrate("Tebak kode 3 digit:")
        success = False
        for attempt in range(1, 4):
            ans = input(f" Kombinasi (percobaan {attempt}/3): ").strip()
            if ans == "431":
                narrate("KREK-KREK-KREK… Gembok terbuka!")
                narrate("Di dalam loker: foto-foto bullying, logbook, dan bukti kuat lainnya!")
                say("Adrian", "Wow, ini dia!")
                narrate("Adrian menemukan foto-foto bullying yang melibatkan Alex, Tristan, dan Dafir.")
                state["clue"] += 8
                state["lokertua_opened"] = True
                success = True
                break
            else:
                narrate("Gembok masih terkunci. Coba lagi.")
                if attempt == 2:
                    narrate("Hint terakhir: Ingat aturannya: Turun = baca mundur, posisi awal tengah = angka tengah ke akhir.")
        if not success:
            narrate("Waktu habis. Loker tetap terkunci.")
            narrate("Adrian harus mencari cara lain lain kali.")
            state["loker_dibuka"] = False
    return True
# ==============================
# ENDING JALUR FIRDAUS — KLIMAKS & EPILOG (DENGAN OPSI MENDAMAIKAN KORBAN)
# ==============================
def ending_firdaus() -> None:
    slow_print_center("=== HARI PENENTUAN ===", wait=True)
    show_ascii("ruang_bk")       
    time.sleep(1)
    # === INISIALISASI STATE ===
    clue = state.get("clue", 0)
    moral = state.get("moral", 0)
    kronologi_kuat = state.get("kronologi_kuat", False)
    bukti_digital = state.get("bukti_digital", False)
    percaya_dianira = state.get("percaya_dianira", False)
    rencana_bk = state.get("rencana_bk", False)
    narrate("Adrian dan Firdaus tiba di ruang BK, membawa semua bukti yang telah mereka kumpulkan.")
    narrate("Bu Madrinah menatap mereka dengan serius.")
    say("Bu Madrinah", "Baiklah, mari kita mulai sesi klarifikasi ini.")
    narrate("Alex dan Michael duduk di hadapan mereka, tampak gugup.")
    # === LAPORAN AWAL ===
    narrate("Adrian dan Firdaus menyerahkan semua bukti.")
    if kronologi_kuat:
        narrate("Kronologi sempurna. Tidak ada celah.")
    if bukti_digital:
        narrate("Bukti digital dari HP Alex membuat Alex gelisah.")
    narrate("Bu Madrinah memanggil ALEX dan MICHAEL.")
    say("Alex", "Ini semua fitnah, Bu! Mereka cuma iri!")
    # === SAKSI PERTAMA ===
    narrate("Pilih saksi pertama:")
    saksi1 = choice_prompt(["Kilau, Leya, Amelia", "Dianira & Khenza", "Balqis & Felis"])
  
    if saksi1 == 1:
        narrate("Kesaksian masa lalu Alex memperkuat motif.")
        clue += 2
    elif saksi1 == 2:
        narrate("Dianira & Khenza mengaku. Bukti melonjak.")
        clue += 3
        if percaya_dianira:
            say("Dianira", "Aku menyesal. Aku bantu karena ingin menebus.")
    else:
        narrate("Balqis & Felis membela Alex. Suasana memanas.")
        clue -= 1
    # === DILEMA DIANIRA ===
    if saksi1 == 2 or state.get("dianira_disebut", False):
        say("Alex", "Kalau aku salah, Dianira juga ikut dulu!")
        narrate("Dianira menunduk. Ruangan hening.")
        say("Bu Madrinah", "Dianira, jelaskan posisimu.")
      
        if percaya_dianira:
            say("Adrian", "Bu, dia sudah bertobat. Catatan dan HP adalah buktinya.")
            state["dianira_dimaafkan"] = True
            moral += 2
        else:
            percaya = choice_prompt(["Bela Dianira", "Biarkan Disebut"])
            if percaya == 1:
                say("Adrian", "Dia membantu kami. Itu cukup.")
                state["dianira_dimaafkan"] = True
                moral += 1
            else:
                narrate("Adrian diam. Dianira disebut bersalah.")
                state["dianira_disebut"] = True
                moral -= 2
    # === SAKSI KEDUA ===
    narrate("Panggil saksi kedua:")
    saksi2 = choice_prompt(["Rusydan", "Daka & Spartan", "Pratama"])
  
    if saksi2 == 1:
        say("Rusydan", "Aku lihat Alex sembunyi tas Dafir.")
        clue += 1
    elif saksi2 == 2:
        say("Daka", "Ini rekaman suara bullying!")
        clue += 3
    else:
        say("Pratama", "Aku nggak tahu apa-apa!")
        clue -= 1
    # === SECRET MESSAGE ===
    if clue < 5 and not kronologi_kuat:
        narrate("[HP Adrian bergetar]")
        narrate("Pesan dari 'ayamgepreklovers01':")
        narrate(" 'Cek meja 4 perpustakaan. File Log Michael. Jangan tanya. -DC'")
        narrate("Bukti tambahan ditemukan!")
        clue += 4
        state["ikhbar_help"] = True
    # === KORBAN MASUK ===
    say("Alex", "Bawa korban langsung kalau berani!")
    narrate("DAFIR, Tristan, Nita, Vara masuk. Suasana mencekam.")
    say("DAFIR", "Kalian hancurkan masa depan kami...")
    narrate("Alex menunduk. Michael gelisah.")
    # === ADRIAN MENDAMAIKAN KORBAN (OPSI BARU!) ===
    narrate("Adrian melangkah maju. Menatap korban satu per satu.")
    say("Adrian", "Sebelum Bu Madrinah memutuskan... kalian ingin apa?")
    say("Adrian", "Apakah kalian ingin berdamai... atau keadilan penuh?")
    opsi_korban = choice_prompt([
        "Memaafkan (Rekonsiliasi)",
        "Mendamaikan Secara Pribadi (Bicara Langsung)",
        "Menghukum (Keadilan Penuh)"
    ])
    # === KONKLUSI GURU BK ===
    say("Bu Madrinah", "Berdasarkan bukti, Alex dan Michael bersalah utama.")
    if state.get("dianira_disebut"):
        narrate(" Dianira juga terlibat dulu.")
    else:
        narrate(" Dianira membantu penyelidikan.")
    narrate("Pratama, Khenza, Balqis, Felis juga terlibat.")
    # === EPILOG BERDASARKAN PILIHAN KORBAN ===
    if opsi_korban == 1:
        narrate("Alex & Michael diskors 6 bulan + wajib ikut konseling.")
        narrate("Di lapangan, Alex menangis: 'Maaf... aku akan berubah.'")
        say("DAFIR", "Kami maafkan. Tapi jangan lagi.")
        say("Tristan", "Kita semua bisa mulai dari nol.")
        if rencana_bk:
            say("Firdaus", "Laporan resmi adalah langkah terbaik.")
        say("Adrian", "Keadilan bukan balas dendam. Ini tentang masa depan.")
    elif opsi_korban == 2:
        narrate("Alex & Michael diskors 3 bulan + wajib minta maaf langsung.")
        narrate("Di ruang kosong, Alex berlutut di depan DAFIR:")
        say("Alex", "Aku salah. Aku takut kehilangan segalanya.")
        say("DAFIR", "Aku juga takut. Tapi sekarang... kita bisa saling mengerti.")
        narrate("Tristan memeluk Nita. Vara tersenyum.")
        say("Firdaus", "Lo bener, Ad. Kadang kata lebih kuat dari hukuman.")
        say("Adrian", "Ini bukan akhir. Ini awal yang baru.")
        state["moral"] += 3
    else:
        narrate("Alex & Michael DIKELUARKAN. Khenza dkk diskors 3 bulan.")
        say("Michael", "Lo pikir lo menang?")
        say("Adrian", "Bukan menang. Ini keadilan.")
        say("Tristan", "Kalian selamatkan kami. Terima kasih.")
        if bukti_digital:
            narrate("Bukti digital menjadi kunci kemenangan.")
    # === PENUTUP EMOSIONAL ===
    narrate("Seminggu kemudian...")
    say("Bu Madrinah", "Adrian, kamu teladan moral sekolah ini.")
    say("Firdaus", "Kita berhasil, Bro. Lo pahlawan sejati.")
  
    if moral >= 6:
        narrate("Adrian tersenyum. 'Bukan pahlawan. Hanya orang yang memilih benar.'")
    elif moral >= 3:
        narrate("Adrian menghela napas. 'Kita menang... tapi ada yang hilang.'")
    else:
        narrate("Adrian menatap lantai. 'Apakah ini cukup?'")
    # Update state final
    state["clue"] = clue
    state["moral"] = moral
    return
# ==============================
# ENDING JALUR ALEX — UJIAN KEKUATAN DAN MORALITAS
# ==============================
def ending_alex() -> None:
    # === INISIALISASI STATE ===
    moral = state.get("moral", 5)
    bertemen_alex = state.get("bertemen_alex", False)
    ikut_bullying = state.get("ikut_bullying", False)
    khianati_firdaus = state.get("khianati_firdaus", False)
    lapor_bk = state.get("lapor_bk", False)
    # ==============================
    # BAD ENDING: KETERLIBATAN & KEKUASAAN
    # ==============================
    if (moral <= 2 and bertemen_alex and (ikut_bullying or khianati_firdaus)):
        slow_print_center("=== HARI PENENTUAN ===", wait=True)
        # Scene 9: Gudang Olahraga
        narrate("Gudang Olahraga Belakang berasa gelap, pengap, bau keringat lama yang menempel di udara.")
        narrate("Lampu kuning redup berayun pelan, menimbulkan bayangan seperti ayunan tali gantung.")
        narrate("Adrian masuk. Pintu menutup sendiri, mengeluarkan bunyi dentuman rendah.")
        narrate("Tiba-tiba, seseorang menepuk bahunya—keras.")
        narrate("Adrian tersentak. Alex berdiri di belakangnya, senyum miringnya tidak pernah terlihat semenyeramkan ini.")
        say("Alex", "Kerja bagus, Bro. Lo lulus ujian loyalitas.")
        narrate("Dari sudut ruangan, Michael muncul dari kegelapan. Wajahnya tidak terbaca.")
        say("Michael", "Selamat datang di circle. Mulai sekarang… lo tangan kanan Alex.")
        narrate("[Internal Monolog Adrian]: 'Aku aman. Tapi… Firdaus? Daka? Mereka nggak akan aman dari ini.'")
        narrate("[Internal Monolog]: 'Aku… sudah terlalu jauh untuk balik.'")
        # Pilihan kritis
        choice = choice_prompt(["Menerima Jabatan", "Menolak (Terlambat)"])
        if choice == 1:
            narrate("Adrian menelan ludah, lalu berbohong pada dirinya sendiri.")
            say("Adrian", "Gue… setuju. Gue ikut.")
            narrate("Michael menepuk dadanya dua kali pelan, tanda keanggotaan.")
            say("Michael", "Selamat datang di keluarga.")
            say("Alex", "Akulah... Alexander The Great!")
        else:
            narrate("Adrian mundur setengah langkah, suara gemetar.")
            say("Adrian", "Tunggu… gue nggak bisa…")
            narrate("Alex mendekat sampai hidung mereka hampir bersentuhan.")
            say("Alex", "Terlambat, Bro. Lo udah di dalam. Keluar artinya… lo musuh gue.")
        # Epilog: Mahkota Berkarat
        narrate("Hari itu, Adrian resmi menjadi tangan kanan Alex—setidaknya di mata publik.")
        narrate("Di kantin, lorong, bahkan lapangan: semua menunduk ketika Adrian lewat.")
        narrate("Bukan hormat. Bukan kagum.")
        narrate("Takut.")
        narrate("Adrian akhirnya melihat dunia seperti Alex: setiap orang hanyalah pion… atau ancaman.")
        # Konfrontasi Firdaus
        show_ascii("lorong")       
        time.sleep(1)
        narrate("Lorong sepi dekat tangga darurat… hanya suara angin lewat ventilasi.")
        narrate("Firdaus berdiri di ujung lorong, wajahnya tidak menunjukkan kemarahan—hanya kekecewaan.")
        say("Firdaus", "Lo jual integritas lo, Adrian.")
        say("Firdaus", "Gue cabut semua kata-kata gue. Jangan panggil gue teman lagi.")
        narrate("Firdaus pergi tanpa menoleh. Hening yang tertinggal terasa lebih menusuk daripada teriakan mana pun.")
        # Puncak Penyesalan
        narrate("Dua minggu kemudian…")
        show_ascii("gerbang")       
        time.sleep(1)
        narrate("DAFIR pindah sekolah. Saat ia melewati Adrian di gerbang, tatapannya bukan marah.")
        narrate("Tapi kasihan. Kasihan karena Adrian memilih tenggelam bersama Alex.")
        narrate("Adrian berpura-pura tidak peduli. Tapi dadanya terasa kosong.")
        narrate("Malam itu — layar ponsel menyala.")
        narrate("Chat dari Alex muncul seperti vonis:")
        narrate("'Besok kunci ruang multimedia. Ada yang harus dikasih pelajaran.'")
        narrate("Adrian menatap pesan itu lama. Terlalu lama.")
        narrate("Ia mengetik dua huruf.")
        narrate("'Oke.'")
        narrate("Di titik itu, Adrian bukan lagi korban… atau teman… atau siswa.")
        narrate("Ia sedang berubah menjadi Alex yang baru. Bayangan dari dirinya yang dulu.")
        # ==============================
        # JALUR ALEX - REDEMPTION ARC (kondisional)
        # ==============================
        # Puncak Penyesalan — sebelum Adrian benar-benar ikut Alex
        narrate("Malam itu — layar ponsel menyala.")
        narrate("Chat dari Alex muncul seperti vonis:")
        narrate("'Besok kunci ruang multimedia. Ada yang harus dikasih pelajaran.'")
        narrate("Adrian menatap pesan itu lama. Terlalu lama.")
        narrate("Ini adalah titik tanpa balik… kecuali ia memilih sebaliknya.")
        # === PILIHAN PENTING: LAPOR ATAU IKUT ===
        narrate("Apa yang akan Adrian lakukan?")
        opsi = [
            '“Oke… gue ikut.” (Tetap setia pada Alex)',
            '“Tidak. Gue harus lapor.” (Pengkhianatan & Redemption)'
        ]
        pilih = choice_prompt(opsi)
        # ========== JIKA LAPOR ==========
        if pilih == 2:
            state["lapor_bk"] = True
            narrate("Adrian menggenggam ponselnya erat.")
            narrate("Di dadanya, sesuatu terasa pecah — rasa takut… dan tekad.")
            narrate("Ia tahu keputusan ini tidak bisa dibatalkan.")
            # ===================================
            # ======= ARC REDEMPTION MULAI =======
            # ===================================
            narrate("Namun... di tengah gelapnya malam, pikiran Adrian tidak tenang.")
            narrate("Bayangan Alex… suara DAFIR… tatapan Firdaus… semuanya menekan dadanya.")
            narrate("Adrian duduk di ujung ranjang, menggenggam ponsel erat.")
            narrate("[Internal Monolog]: 'Kalau gue terusin ini… bakal ada korban lagi.'")
            narrate("[Internal Monolog]: 'Gue yang bawa bencana. Jadi gue yang harus berhentiin.'")
            narrate("Tangan Adrian gemetar saat mengetik pesan:")
            narrate("'Bu… saya mau lapor. Soal Alex. Soal semuanya.'")
            narrate("Layar ponsel memancarkan cahaya kecil di ruangan gelap.")
            narrate("Itulah pertama kalinya Adrian membelot dari Alex… bukan demi dirinya,")
            narrate("tapi demi orang lain — dan demi menebus dirinya sendiri.")
            # Konfrontasi BK
            narrate("Keesokan harinya — Ruang BK.")
            narrate("Bu Madrinah memandang Adrian dengan serius.")
            say("Bu Madrinah", "Kamu sadar risiko tindakanmu?")
            narrate("Adrian mengangguk. Tidak gemetar. Tidak lari.")
            say("Adrian", "Kalau gue diem… semua makin parah.")
            narrate("Bu Madrinah mengetik cepat, membuat laporan resmi.")
            narrate("Untuk pertama kalinya, Adrian merasakan sesuatu mirip keberanian —")
            narrate("bukan keberanian Alex, tapi keberanian untuk melepaskan pengaruh Alex.")
            # Reaksi Alex
            narrate("Sore itu… Alex dipanggil ke Ruang BK.")
            narrate("Adrian menunggu di luar. Nafasnya pendek. Jari-jarinya dingin.")
            narrate("Dari dalam terdengar suara Alex: 'APAAN INI?! SIAPA YANG NGADU?!'")
            narrate("Pintu terbuka keras.")
            narrate("Alex keluar, wajahnya seperti badai.")
            narrate("Tapi begitu melihat Adrian… badai itu berhenti sejenak.")
            say("Alex", "Lo…?")
            narrate("Adrian tidak mundur.")
            say("Adrian", "Gue nggak mau jadi monster kayak lo, Lex.")
            narrate("Hening. Berat. Menyesakkan.")
            say("Alex", "...Nyesel lu nanti.")
            narrate("Tapi nadanya bukan ancaman… melainkan luka.")
            # Para korban dipanggil
            narrate("Beberapa korban dipanggil ke Ruang BK sore itu.")
            narrate("Dafir. Tristan. Vara. Nita. Dan beberapa yang lain.")
            narrate("Alex berdiri di depan mereka — bukan sebagai penguasa, tapi sebagai orang yang harus mempertanggungjawabkan tindakan.")
            say("Alex", "Gue minta maaf… ke semuanya.")
            narrate("Suaranya pecah. Tidak teaterikal. Tidak dipaksa.")
            narrate("Seperti seseorang yang akhirnya melihat dirinya dalam kaca yang retak.")
            narrate("Dafir menunduk, tidak lagi takut.")
            narrate("Tristan menggenggam tasnya kuat-kuat, tapi tidak menjauh.")
            narrate("Vara menghapus air mata tanpa suara.")
            narrate("Nita hanya mengangguk kecil.")
            narrate("Pada momen itu, Adrian menyadari sesuatu:")
            narrate("Keadilan tidak selalu datang dengan sorak-sorai.")
            narrate("Kadang ia datang dengan hening, air mata, dan kesempatan kedua.")
            # Penutup redemption
            narrate("Malamnya, Adrian berjalan pulang sendirian.")
            narrate("Tidak sebagai tangan kanan Alex.")
            narrate("Tidak sebagai pion.")
            narrate("Tapi sebagai seseorang yang — untuk pertama kalinya — memilih jalannya sendiri.")
            narrate("Penebusannya dimulai malam itu.")
        # ========== JIKA IKUT ALEX ==========
        else:
            state["lapor_bk"] = False
            narrate("Adrian memejamkan mata.")
            say("Adrian", "Oke… gue ikut.")
            narrate("Dan dengan itu… ia memilih jalan Alex.")
      
# ==============================
# ENDING JALUR NETRAL — BERDASARKAN CLUE & MORAL
# ==============================
def ending_netral() -> None:
    # === HITUNG SKOR ===
    clue = state.get("clue", 0)
    moral = state.get("moral", 0)
    observasi = state.get("observasi", 0)
    kronologi_kuat = state.get("kronologi_kuat", False)
    bukti_digital = state.get("bukti_digital", False)
    # ==============================
    # GOOD ENDING: PENGAMATAN YANG MENANG
    # ==============================
    if clue >= 10 and moral >= 5:
        slow_print_center("=== HARI PENENTUAN ===", wait=True)
        narrate("Adrian melakukan pengumpulan bukti dan menyusun kronologi")
        # === PENGUMPULAN BUKTI & KRONOLOGI ===
        narrate("Adrian mengumpulkan bukti diam-diam selama berminggu-minggu.")
        if observasi >= 3:
            narrate("Catatan harian di buku kecil: setiap kejadian, waktu, saksi.")
        if bukti_digital:
            narrate("Foto, rekaman suara, tangkapan layar chat — semua tersimpan.")
        if kronologi_kuat:
            narrate("Kronologi disusun rapi: dari gagal olimpiade hingga bullying Dafir.")
            narrate("Semua terhubung. Tidak ada celah.")
        else:
            narrate("Kronologi cukup kuat. Cukup untuk meyakinkan BK.")
        narrate("Hari terakhir sebelum libur semester...")
        narrate("Adrian duduk sendirian di kantin, mengamati semuanya.")
        narrate("Tiba-tiba, Bu Madrinah menghampiri dengan map tebal.")
        say("Bu Madrinah", "Adrian, catatanmu tentang bullying... luar biasa.")
        say("Pak Firman", "Kalau bukan karena kamu, kami mungkin tidak akan tahu apa-apa.")
        say("Pak Firman", "Dengan bantuan Ketua OSIS Gita, kami mendapatkan beberapa testimoni korban")
        say("Adrian", "Terima kasih, Saya hanya melakukan apa yang benar.")
        narrate("Seminggu kemudian...")
        narrate("Adrian menikmati makan siang di kelas, dan sedang mengobrol dengan Firdaus.")
        say("Firdaus", "Ad, menurutmu, apa yang harus kita lakukan selanjutnya?")
        say("Adrian", "Santai aja dulu. Aku yakin Bu Madrinah dan Pak Firman akan menanganinya.")
        say("Firdaus", "Benar juga")
        narrate("...")
        narrate("DAFIR dan Tristan mendekati meja Adrian.")
        say("Adrian", "DAFIR, Tristan, ada apa?")
        say("DAFIR", "Adrian... kami mau berterima kasih. Kamu sudah menyelamatkan kami.")
        say("Tristan", "Kami nggak tahu harus gimana tanpa kamu.")
        say("Adrian", "Ah, nggak usah dibesar-besarkan. Aku cuma ngelakuin yang benar.")
        narrate("DAFIR dan Tristan pergi dengan senyum lega.")
        narrate("Firdaus dari memberi jempol.")
    # ==============================
    # BAD ENDING: PENGAMATAN YANG GAGAL
    # ==============================
    elif clue < 5 and moral < 2:
        slow_print_center("=== HARI PENENTUAN ===", wait=True)
        narrate("Adrian menikmati hari-harinya di sekolah, mencoba menghindari masalah.")
        narrate("Namun, ia merasa ada yang tidak beres.")
        narrate("Libur semester dimulai...")
        narrate("Adrian duduk sendirian di bangku taman sekolah yang kosong.")
        narrate("Tiba-tiba, berita menyebar: DAFIR dan Tristan pindah sekolah.")
        narrate("Alex dan gengnya masih berkuasa. Tidak ada perubahan.")
        narrate("Hari pertama masuk kembali...")
        narrate("Alex menghadang Adrian di gerbang.")
        show_ascii("gerbang")       
        time.sleep(1)
        say("Alex", "Lo pikir lo pintar ngumpet? Sekarang giliran lo.")
        narrate("Pratama dan Michael mengejek dari belakang.")
        narrate("Tas Adrian diambil. Ponselnya dilempar ke selokan.")
        narrate("Adrian sekarang jadi korban baru.")
        narrate("[Internal Monolog]: 'Hadehh... '")
        narrate("Alex berkuasa. Adrian kehilangan segalanya...")
    # ==============================
    # GOOD ENDING: PERUBAHAN & PENEBUSAN
    # ==============================
    else:
        slow_print_center("=== HARI PENENTUAN ===", wait=True)
        # Scene 9: Pengkhianatan Terpaksa
        narrate("Koridor sepi dekat toilet...")
        show_ascii("toilet")       
        time.sleep(1)
        narrate("Alex menyergap Adrian, wajahnya merah padam.")
        say("Alex", "LO NGADU KE GURU?! GUE PERCAYA SAMA LO!")
        say("Adrian", "Ini salah, Lex. Lo hancurkan hidup orang lain.")
        say("Alex", "Terserah! Mulai sekarang, lo musuh gue!")
        say("Adrian", "Oke, Lihat aja nanti.")
        narrate("Ponsel Alex berdering. Wajahnya memucat.")
        say("Alex", "Sialan! Michael kabur! Polisi dateng!")
        narrate("Alex lari sekencang-kencangnya. Ponselnya jatuh.")
        # Epilog: Persidangan Sendiri
        narrate("Tanpa Michael, Alex jadi target mudah.")
        say("Bu Madrinah", "Alex diskors 6 bulan + rehabilitasi. Adrian pilih jalur rehabilitasi, bukan pengusiran.")
        # Momen Alex Minta Maaf
        narrate("Kantin — seminggu kemudian...")
        narrate("Alex mendekati meja Adrian, Firdaus, dan Daka.")
        say("Alex", "Adrian... gue minta maaf.")
        say("Adrian", "Buktikan aja, Lex. Ubah diri lo.")
        say("Alex", "Gue nggak akan lupa. Lo bisa hancurkan gue... tapi lo nggak.")
        narrate("Alex pergi dengan langkah berat, penuh penyesalan.")
        # Penghargaan dari Firdaus & Bu Madrinah
        narrate("Koridor...")
        say("Firdaus", "Lo nggak cuma menang keadilan, Ad. Lo menang moralitas Alex.")
        say("Bu Madrinah", "Kamu contoh. Api gelap bisa dipadamkan oleh integritas.")
# ==============================
# CREDIT SCREEN —
# ==============================
def credit_screen():
    cls()
    print("\n" * 10)  # kasih jarak biar mulai dari tengah

    credits = [
        "",
        "                                   OUTSIDER",
        "",
        "                       Created by: Davin Varian Ikhbar & Muhammad Raffa Danendra",
        "                       AI Assistant: Grok • Gemini • ChatGPT • Copilot",
        "",
        "                       CONCEPT & WRITING",
        "                       Davin Varian Ikhbar",
        "",
        "                       VISUAL DESIGN & ASCII ART",
        "                       Muhammad Raffa Danendra",
        "",
        "                       CODE & OPTIMIZATION",
        "                       Davin Varian Ikhbar & Muhammad Raffa Danendra",
        "",
        "                       SPECIAL THANKS",
        "                       Kelas XII-2 / Zolasda (Zona Dua Belas Dua)",
        "",
        "                       KARAKTER",
        "                       Adrian • Firdaus • Alex • Michael • Dafir • Dianira",
        "                       Rusydan • Maul • Spartan • Daka • Pratama • Gita",
        "                       Kilau • Leya • Amelia • Khenza • Balqis • Felis",
        "                       Tristan • Danendra • Ikhbar • Vara • Nita",
        "                       Pak Firman • Bu Madrinah • Pak Budi • Pak Udin • Mak Nyak",
        "",
        "                       Terima kasih telah menyelesaikan",
        "                              OUTSIDER",
        "",
        "                       © 2025 SMA Negeri 01 Batu",
        "                            All Rights Reserved",
        "",
        "                                          THE END",
        "" 
    ]

    # Reverse biar ngalir dari bawah ke atas
    for i in range(len(credits) + 30):  # +30 biar ada jeda di akhir
        cls()
        print("\n" * 5)
        
        # Tampilin kredit yang lagi lewat
        start = max(0, i - 25)
        end = i
        for j in range(start, end):
            if j < len(credits):
                line = credits[j].center(100)
                # Efek warna gradien (opsional, keren banget)
                if "THE END" in line:
                    print(Color.BOLD + Color.YELLOW + line + Color.END)
                elif "OUTSIDER" in line:
                    print(Color.BOLD + Color.CYAN + line + Color.END)
                elif "Terima kasih" in line:
                    print(Color.GREEN + line + Color.END)
                else:
                    print(Color.DIM + line + Color.END)
            else:
                print()

        time.sleep(0.35)  # kecepatan ngalir (ubah kalo mau lebih cepet/lambat)

    # Akhir: tampilin "THE END" besar + tunggu Enter
    cls()
    print("\n" * 10)
    print(Color.BOLD + Color.YELLOW + "T H E   E N D".center(100) + Color.END)
    print("\n" * 5)
    input(f"{Color.GREEN}          Tekan ENTER untuk kembali ke menu utama...{Color.END}".center(100))
# ==============================
# ========== MAIN FLOW (FIXED & SAFE) ==========
# ==============================
def print_summary():
    slow_print_center("\n" + "="*60)
    slow_print_center("=== AKHIR PERJALANAN ADRIAN ===", wait=True)
    slow_print_center("="*60 + "\n")
  
    display_stats = [
        ("Moral:", "moral"),
        ("Pengaruh Negatif:", "pengaruh_negatif"),
        ("Pengaruh Positif:", "persahabatan_firdaus"),
        ("Clue Ditemukan:", "clue")
    ]
    for label, key in display_stats:
        val = state.get(key, 0)
        narrate(f"{label}: {val}")
    return
def main():
    # ==============================
    # INISIALISASI STATE LENGKAP
    # ==============================
    global state
    state = {
        # === STAT UTAMA ===
        "moral": 5,
        "pengaruh_negatif": 0,
        "persahabatan_firdaus": 0,
        "clue": 0,
        # === JALUR & FLAG UTAMA ===
        "jalur": "netral",
        "waspada": 0,
        "cuek": 0,
        "observasi": 0,
        "digital_clue": 0,
        "bukti_digital": False,
        "kronologi_kuat": False,
        # === FLAG JALUR FIRDAUS ===
        "percaya_dianira": False,
        "rencana_bk": False,
        # === FLAG JALUR ALEX ===
        "bertemen_alex": False,
        "ikut_bullying": False,
        "khianati_firdaus": False,
        # === FLAG LAIN ===
        "lapor_bk": False,
        "dianira_disebut": False,
        "dianira_dimaafkan": False,
        # === FLAG DARI STATE LAMA (WAJIB AGAR TIDAK KEYERROR) ===
        "informasi_clue": 0,
        "loker_hint": False,
        "investigasi": 0,
        "lokasi_investigasi": None,
        "hari_berganti": False,
        "dianira_notes": False,
        "kunci_tua": False,
        "lokertua_opened": False,
        # RELASI & KARAKTER
        "relasi_maul": 0,
        "relasi_spartan": 0,
        # ITEM
        "usb": False,
        # RUTE SOSIAL
        "ikhbar_help": False,
        "alex_skeptis": False,
        "alex_menganggap_lemah": False,
        "alex_marah_besar": False,
        "insight_sosial": False,
        "korban_dibantu": False,
        # ENDING
        "alex_ditangkap": False,
        "ending_route": None
    }
    # ==============================
    # ALUR GAME
    # ==============================
    pre_intro_opening()
    meet_pak_budi_and_firdaus()
    seat = seat_choice()
    first_lesson(seat)
    break_time(seat)
    middle1(seat)
    middle2(seat)
    middle3(seat)
    jalur = state.get("jalur", "netral")
    if jalur == "firdaus":
        ending_firdaus()
    elif jalur == "alex":
        ending_alex()
    else:
        ending_netral()
    print_summary()
    narrate("Terima kasih telah memainkan 'OUTSIDER'!")
    credit_screen()
if __name__ == "__main__":
    cls()
    choice = intro_menu() 
    
    # Load save kalo user milih "continue"
    if choice == "continue":
        state.update(load_save())
        main()
    elif choice == "new":
        delete_save()
        main()
    elif choice == "settings":
        narrate("Settings belum tersedia.")
    # type: ignore